{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"LTRENT-2387","text":"<p>Welcome to Cisco Live LTRENT-2387 - Harnessing SD-WAN for Safe Cloud Adoption: Unlocking Cloud Security</p> <p>For full documentation visit Cisco Live.</p>"},{"location":"#speakers","title":"Speakers","text":"<ul> <li>Faisal Chaudhry <code>Distinguished Architect, Cisco CX</code></li> <li>Khurram Afzal <code>Solution Architect, Cisco CX</code></li> </ul>"},{"location":"IP-Users/","title":"IP Users","text":"<p>#Address Plan, Connection Details and Credentials</p>"},{"location":"IP-Users/#wan-edges---internal","title":"WAN Edges - Internal","text":"Node System IP Site ID VPN 10 Loopback10 Site100-cE1 1.1.10.1 100 100.110.10.1 Site200-cE1 1.1.20.1 200 100.110.20.1 Site300-cE1 1.1.30.1 300 100.110.30.1 Site400-cE1 1.1.40.1 400 100.110.40.1 <p>##WAN Edges \u2013 External</p> Node MPLS TLOC (Gi2) Internet TLOC (Gi1) VPN 10 LAN (Gi3) VPN 12 LAN (Gi3) Site100-cE1 10.1.2.2/24 10.2.2.2/24 10.10.1.1/24 - Site200-cE1 10.1.4.2/24 10.2.4.2/24 10.20.1.1/24 - Site300-cE1 10.1.6.2/24 10.2.6.2/24 10.30.1.1/24 10.32.1.1/24 Site400-cE1 10.1.7.2/24 10.2.7.2/24 10.40.1.1/24 10.42.1.1/24 <p>##Controllers |Node|  System  |Site ID| |\u2014|\u2014|\u2014| |vManage|   1.1.1.1|    1| |vBond| 1.1.1.2|    -| |vSmart-1|1.1.1.3|  1| |vSmart-2|1.1.1.4|  1|</p> <p>##3rd Party Devices |Node|  Type|   Site|   VPN ID |    IP address| |\u2014|\u2014|\u2014|\u2014|\u2014| |Site300-Ubuntu-VPN10|  Host|   300 |10 |10.30.1.10/24| |Site300-Ubuntu-VPN12|  Host|   300 |12|10.32.1.10/24| |Site400-Ubuntu-VPN10|  Host|   400|10  |10.40.1.10/24| |Site400-Ubuntu-VPN12|  Host|   400 |12 |10.42.1.10/24|</p> <p>##UI Credentials and Connection Details |Node|  IP|Port|Username|Password| |\u2014|\u2014|\u2014|\u2014|\u2014| |vManage|   198.18.133.200|8443|    admin   |C1sco12345| |Site300-Ubuntu-VPN10|198.18.133.200|30503|ubuntu|viptela| |Site300-Ubuntu-VPN12|198.18.133.200|30504|ubuntu|viptela| |Site400-Ubuntu-VPN10|198.18.133.200|30501|ubuntu|viptela| |Site400-Ubuntu-VPN12|198.18.133.200|30500|ubuntu|viptela|</p> <p>##SSH Credential and Connection Details |Node|  IP|Port|Username|Password| |\u2014|\u2014|\u2014|\u2014|\u2014| |vManage|198.18.133.200|19001|admin|C1sco12345| |vBond|198.18.133.200|19002|admin|admin| |vSmart-1|198.18.133.200|19003|admin|admin| |vSmart-2|198.18.133.200|19005|admin|admin| |Site100-cE1|198.18.133.200|19007|admin|admin| |Site200-cE1|198.18.133.200|19011|admin|admin| |Site300-cE1|198.18.133.200|19017|admin|admin| Site400-cE1|198.18.133.200|19021|admin| admin|</p>"},{"location":"Task1-Connect/","title":"Task-1 VPN connection","text":"<p>Your first task will log on to remote lab using VPN.  At the end of this task, you will have a fully network connectivity to a remote server using Remote Desktop.</p>"},{"location":"Task1-Connect/#step-1-connect-to-lab-using-anyconnect-vpn","title":"Step 1: Connect to lab using anyconnect VPN","text":"<p>You will connect to remote Lab using Cisco VPN AnyConnect client, as shown in below picture.</p> <ul> <li>Launch the Cisco VPN AnyConnect client from your PC</li> <li> <p>Enter the remote server for your pod as provided by Lab Speakers.</p> <ul> <li>This remote server will be <code>dcloud-sjc-anyconnect.cisco.com</code> or <code>dcloud-rtp-anyconnect.cisco.com</code> </li> </ul> </li> <li> <p>The <code>username</code> and <code>password</code> credentials for this VPN connection will also be provided by the lab admin </p> </li> </ul> Note: Lab admins will furnish the credentials information to each participant.  If you don't have this information please ask the lab speakers. <p></p> <p>Below is an example of user logging into a reference pod in <code>dcloud-sjc-anyconnect.cisco.com</code>:</p> <p></p> <ul> <li> <p>Hit Accept when the prompt appears to accept the VPN connection login    </p> <p></p> </li> </ul> Note: Credentials used in above screenshot are provided as an example only.  Credentials for each pod will be provided by the lab speakers."},{"location":"Task1-Connect/#step-2-rdp-to-workstation","title":"Step 2: RDP to workstation","text":"<p>In this step, you will connect to the workstation with Remote Desktop (RDP) client on your machines.  Use below details for this RDP session:</p> <ul> <li>Workstation/Computer: <code>198.18.133.36</code></li> <li>Username: <code>Admin</code></li> <li>Password: <code>C1sco12345</code></li> </ul> <p>Below screenshot is only an example for this RDP connection:</p> <p></p> <p>Note:  above screenshot is provided as an example only.  </p>"},{"location":"Task1-Connect/#step-3-mtputty-and-browser","title":"Step 3: MTPutty and Browser","text":"<p>Once you have the RDP session to the remote workstation (Jumphost), then you will use MTputty client (pre-installed on the remote workstation) and Chrome Browser to connect to all devices in this lab. </p> <p>MTputty is already installed on the Desktop of the workstation where you connected using RDP.  Run this application by clicking on the icon on the desktop:</p> <p></p>"},{"location":"Task10/","title":"Task 10 - Block Page","text":"<p>This tasks will walk through the steps to modify the Block page that is shown to users when a Web policy is enforced on Site-100 and Site-400 (i.e., regional sites).  </p>"},{"location":"Task10/#step-1---umbrella-web-policy","title":"Step 1 - Umbrella Web Policy","text":"<p>In this step we will configure a new block page.</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Navigate to Policies &gt; Policy Components &gt; Block Page Appearance.  Then click Add on the top right to add a new Block page as shown in below screenshot:</p> </li> </ul> <p></p> <ul> <li>On the <code>Add New Block Page Appearance</code> web page, configure the below settings:<ul> <li>Name: <code>Block Page Regional</code></li> <li>Click on <code>Block Page Appearance</code> to expand it's settings</li> <li>Click on <code>Show a block page with a custom message</code></li> <li>In the text box, enter text of <code>Regional Block Page</code> (You may enter your own text here!)</li> <li>Click <code>Save</code> at the bottom right</li> </ul> </li> </ul> <p></p> <ul> <li>On Umbrella dashboard, navigate to Policies &gt; Management &gt; Web Policy and click on previously configured <code>Ruleset 2</code></li> </ul> <p></p> <ul> <li>On the Rule 2 page, navigate to Ruleset Settings and scroll down to Block Page setting and click <code>Edit</code>:</li> </ul> <p></p> <ul> <li>On the <code>Block page</code> select Custom Appearance and then select <code>Block Page Regional</code> from the dropdown menu and click Save: </li> </ul> <p></p> <ul> <li>Now the newly created <code>Block Page Regional</code> should appear for under the Settings of <code>Ruleset 2</code>:</li> </ul> <p></p>"},{"location":"Task10/#step-2---verify-new-block-page","title":"Step 2 - Verify new Block Page","text":"<p>Now lets validate that the new Block page is working for SD-WAN Site-400 (Regional site).</p> <ul> <li>Launch console access to ubuntu Site400-Ubuntu-VPN10 host by using mRemoteNG application.  Login with credentials of <code>viptela</code></li> <li>Use Chromium Browser to navigate onto traditional websites, such as <code>www.cisco.com</code>.  Access to this website should work.</li> <li>Use Chromium Browser to navigate to <code>www.chase.com</code>.  As per our Umbrella Web Policy, this sites should be blocked and, as expected, the newly created Umbrella block page will appear.</li> </ul> <p>Now lets validate that the original Block page is shown for SD-WAN Site-300.</p> <ul> <li>Launch console access to ubuntu Site300-Ubuntu-VPN10 host by using mRemoteNG application.  Login with credentials of <code>viptela</code></li> <li>Use Chromium Browser to navigate onto traditional websites, such as <code>www.cisco.com</code>.  Access to this website should work.</li> <li>Use Chromium Browser to navigate to <code>www.cnn.com</code>.  As per our Umbrella Web Policy, this sites should be blocked and, as expected, the original block page will appear.</li> </ul>"},{"location":"Task11/","title":"Task 11 - Data Loss Prevention","text":"<p>Umbrella Data Loss Prevention (DLP) policy helps to protect sensitive data uploaded to the web. It discovers and protects sensitive data stored being exposed outside of an organization.  </p> <p>This tasks will walk through the steps to create policy (called Real Time DLP Rule) that will monitor the web proxy traffic and then allow administrators to decide if the content should only be monitored or blocked.  In this case policy to monitor, and then block, files for General Data Protection Regulation (GDPR) classification will be configured.  The General Data Protection Regulation (GDPR) is a regulation in EU law on data protection and privacy.  Files with personal information such as names, addresses, phone numbers etc must be handled with care.  A sample file will be used to test the compliance of GDPR regulation i.e., monitoring and then enforcing/blocking.</p>"},{"location":"Task11/#step-1---umbrella-dlp-monitor-policy","title":"Step 1 - Umbrella DLP Monitor Policy","text":"<p>In this step we will configure a DLP rule for monitoring GDPR compliance.</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Navigate to Policies &gt; Management &gt; Data Loss Prevention Policy.  Then click Add Rule on the right pane and select <code>Real Time Rule</code> to add a new DLP Policy as shown in below screenshot:</p> </li> </ul> <p></p> <ul> <li>On the <code>Add New Real Time Rule</code> web page, configure the below settings and as shown in below screenshots<ul> <li><code>Rule Name</code>: <code>DLP GDPR</code></li> <li>From the <code>Severity</code> dropdown menu select <code>Medium</code></li> <li>In <code>Data Classifications</code> section, select <code>Built-in GDPR classification</code>.  Note you can click <code>Preview</code> to view the Data Identifiers</li> <li>In the <code>Identities</code>, select <code>Tunnels</code> to use the traffic from all SD-WAN sites</li> <li>In the <code>Destination</code> section, click on <code>All Destinations</code></li> <li>Within <code>Action</code> section, select <code>Monitor</code> from the dropdown menu</li> <li>Click <code>Save</code> at the bottom right</li> </ul> </li> </ul> <p> </p> <p>Now the DLP policy to inspect (Monitor) the compliance of GDPR data has been configured.</p>"},{"location":"Task11/#step-2---sample-file-for-dlp","title":"Step 2 - Sample file for DLP","text":"<p>In this step a sample file to test the previously configured DLP policy will be downloaded on a VM with hostname of Site300-Ubuntu-VPN10 on SD-WAN site-300.  This file has sample data that includes items such as Name, Birth date, Gender, address etc.  If this file is published to cloud, then this data in file will result in raising a compliance alarm on Umbrella, as per our policy.</p> <ul> <li> <p>Launch console access to ubuntu Site300-Ubuntu-VPN10 host by using mRemoteNG application.  Login with credentials of <code>viptela</code>.</p> </li> <li> <p>Use Chromium Browser on this VM to navigate onto website with URL of <code>dlptest.com/sample-data</code>.  </p> </li> <li> <p>Scroll (down) to <code>Sample SSN and CCN Files</code> on this website and then click to download <code>CSV File</code> as shown in below figure.  This file will be automically saved on the <code>Downloads</code> folder on the VM.</p> </li> </ul> <p></p> <p>Now we have the sample file available on our host VM to test it.</p>"},{"location":"Task11/#step-3---validate-dlp-monitor-policy","title":"Step 3 - Validate DLP Monitor Policy","text":"<p>Now validate this DLP policy by publishing this file.  Umbrella will detect the GDPR compliance data violation as per our policy and raise an event in it's reporting.</p> <ul> <li> <p>Launch console access to ubuntu Site300-Ubuntu-VPN10 host by using mRemoteNG application.  Login with credentials of <code>viptela</code></p> </li> <li> <p>Use Chromium Browser to navigate to website: <code>dlptest.com/http-post/</code> </p> </li> <li> <p>On this web page, on Chromium Browser, navigate to <code>File Upload *</code> section.  Click on <code>Drop a file here or click to upload</code> as shown in below screenshot:</p> </li> </ul> <p></p> <ul> <li>On the <code>Open Files</code> page, click on <code>Downloads</code>, then click on <code>sample-data.csv</code> and click <code>Open</code> to upload the file:</li> </ul> <p></p> <ul> <li>The file will be uploaded successfully.  You will see the message as shown in below screenshot</li> </ul> <p></p> <p>Now let's navigate to Umbrella to check if a compliance alarm was raised as per our policy.</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Navigate to Reporting &gt; Additional Reports &gt; Data Loss Prevention.  On the right pane, you should see an <code>Event Type</code> of <code>Real Time</code> with <code>Severity</code> of <code>Medium</code> and other details related to the File upload to <code>DLP Test</code> website.  </p> </li> <li> <p>Further on the right side of each row, click on the three dots (<code>...</code>) and then click <code>View Full Details</code> to check the various GDPR related violations detected by Umbrella.  Below is a sample screenshot for such event, your view may be little different.</p> </li> </ul> <p></p> <p>This event confirms that Umbrella has detected the compliance violation.</p>"},{"location":"Task11/#step-4---umbrella-dlp-block-policy","title":"Step 4 - Umbrella DLP Block Policy","text":"<p>Now let's modify the existing DLP policy to Block (instead of Monitor) the content in case of breach of GDPR compliance</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Navigate to Policies &gt; Management &gt; Data Loss Prevention Policy.   One DLP Rule should appear on the right pane.  Click on the three dots (\u2026) on the right side as shown in below screenshot and then click Edit Rule:</p> </li> </ul> <p></p> <ul> <li>On the <code>Edit Real Time Rule</code> scroll down to the <code>Action</code> section and select the action of <code>Block</code> from the dropdown menu and click <code>Save</code>:</li> </ul> <p></p> <p>Now this rule has been edited with block action instead of just monitor.</p>"},{"location":"Task11/#step-5---validate-dlp-block-policy","title":"Step 5 - Validate DLP Block Policy","text":"<p>Now validate this DLP policy by publishing the test file previously downloaded on VM/host on Site300.  Umbrella will detect the GDPR compliance data violation as per our policy and block uploading of this file.</p> <ul> <li> <p>Launch console access to ubuntu Site300-Ubuntu-VPN10 host by using mRemoteNG application.  Login with credentials of <code>viptela</code></p> </li> <li> <p>Use Chromium Browser to navigate to website: <code>dlptest.com/http-post/</code>.  If you already have this webiste open on Chromium Browser, you must refresh the browser to navigate on to this page again.</p> </li> <li> <p>On this web page, on Chromium Browser, navigate to <code>File Upload *</code> section.  Click on <code>Drop a file here or click to upload</code> as done in previous step in this task.</p> </li> <li> <p>On the <code>Open Files</code> page, click on <code>Downloads</code>, then click on <code>sample-data.csv</code> and click <code>Open</code> to upload the file</p> </li> <li> <p>The file upload will fail.  You will see the message as shown in below screenshot</p> </li> </ul> <p></p> <p>Now let's navigate to Umbrella to check if a compliance event was raised as per our policy.</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Navigate to Reporting &gt; Additional Reports &gt; Data Loss Prevention.  On the right pane, you should see an <code>Event Type</code> of <code>Real Time</code> with <code>Severity</code> of <code>Medium</code> and other details related to the File upload to <code>DLP Test</code> website.  This event should have an action of <code>Blocked</code></p> </li> <li> <p>Further on the right side of each row, click on the three dots (<code>...</code>) and then click <code>View Full Details</code> to check the various GDPR related violations detected by Umbrella.  Below is a sample screenshot for such block event, your view may be little different.</p> </li> </ul> <p></p> <p>This event confirms that Umbrella has detected the compliance violation and resulted in Blocking the upload of this file. </p>"},{"location":"Task2-v1/","title":"Task 2 - vManage Device Templates","text":"<p>Cisco SD-WAN vManage is a centralized network management system that simplifies the configuration, monitoring, and management of Cisco's SD-WAN infrastructure.</p> <p>Cisco vManage Device and Feature templates are key components of the Cisco SD-WAN solution.  These are used to simplify the process of configuring and managing SD-WAN devices in a network. These templates provide a standardized, scalable way to deploy configurations to multiple devices, ensuring consistency and reducing manual errors.</p> <p>In this lab vManage has been pre-configured with various Device and Feature Templates.  The pre-configured templates have all the configurations required for a functional SD-WAN Fabric.</p> <p>In this task we will attach cEdges (Site-100, Site-300 and Site-400) to their respective vManage Device Templates.  The <code>Attach Device</code> step of attaching a cEdge to it's Device templates is performed on the vManage GUI via a web browser.  This process simplifies network management by enabling efficient scalability and reducing manual configuration errors. It allows for quick deployment of new devices and easy updates to existing ones, all while ensuring that network settings adhere to predefined policies and standards.</p>"},{"location":"Task2-v1/#step-1---vmanage-gui","title":"Step 1 - vManage GUI","text":"<p>Objective: In this step, we will access the Cisco SD-WAN vManage through a web browser for provisioning. All provisioning tasks will be performed using a Google Chrome browser on the RDP session (i.e., Jumphost).</p> <ul> <li> <p>Log on to the vManage GUI by launching the <code>Google Chrome</code> web browser, which can be found either on the Desktop or in the Taskbar of your RDP session (Jumphost).   </p> </li> <li> <p>After launching Chrome, click on the <code>vManage</code> bookmark on the bookmark bar.   </p> </li> <li> <p>Log in to vManage using the following credentials:</p> </li> <li>Username: <code>admin</code></li> <li>Password: <code>C1sco12345</code></li> </ul>"},{"location":"Task2-v1/#step-2---device-template-for-cedges","title":"Step 2 - Device Template for cEdges","text":"<p>Objective: In this step, we will manage the device templates for the cEdge devices in the Cisco SD-WAN vManage. This involves identifying and attaching the correct device templates to their respective cEdge devices as per the specified criteria.</p> <p>1. Navigating in vManage: </p> <ul> <li>After logging into vManage, click on the three bars at the top left side to open the navigation menu.   </li> </ul> <p>2. Accessing Device Templates: </p> <ul> <li>Navigate to Configuration &gt; Templates.    </li> </ul> <p>3. Selecting Device Templates: </p> <ul> <li>On the <code>Configuration - Templates</code> page, click on <code>Device Templates</code>.   </li> </ul> <p>4. Identifying cEdge Devices: </p> <ul> <li>The <code>Device Template</code> page lists various control and cEdge devices. We will only attach the device template to their respective cEdge as per the following table. The cEdge devices can be recognized by their <code>Description</code>:</li> </ul> Description vEdge Device template of Site100-cE1 with Site ID: 100 and System IP: 1.1.10.1 Site100-cE1 Device template of Site300-cE1 with Site ID: 300 and System IP: 1.1.30.1 Site300-cE1 Device template of Site400-cE1 with Site ID: 400 and System IP: 1.1.40.1 Site400-cE1 <p>Note: Please don't add Site200-CE1 to any template.</p> <p>5. Attaching Device Templates: </p> <ul> <li> <p>Locate the Site100-cE1 device from its description and click on the three dots (<code>...</code>) on the right side.   </p> </li> <li> <p>On the <code>Attach Devices</code> page, scroll down to or search for <code>Site100-cE1</code> and select it with the Right arrow (<code>&gt;</code>).   </p> </li> <li> <p>After selecting the Site100-cE1, click on <code>Attach</code>.   </p> </li> </ul> <p>6. Completing the Attachment Process: </p> <ul> <li> <p>On the next page, click <code>Next</code>.   </p> </li> <li> <p>Finally, click on <code>Configure Devices</code> to attach the template configurations to the cEdge device.   </p> </li> <li> <p>Wait for the task to be successful.   </p> </li> </ul> <p>Important Note: The above screenshots are for <code>Site-100 cE1</code> only. You must repeat these tasks for <code>Site300-cE1</code> and <code>Site400-cE1</code>.</p> <p>Result: The device templates for cEdge devices are now correctly configured and attached in vManage, ensuring proper management and configuration of these devices as per the network requirements.</p>"},{"location":"Task2/","title":"Task 2 - vManage Device Templates","text":"<p>Cisco SD-WAN vManage is a centralized network management system that simplifies the configuration, monitoring, and management of Cisco's SD-WAN infrastructure.</p> <p>Cisco vManage Device and Feature templates are key components of the Cisco SD-WAN solution.  These are used to simplify the process of configuring and managing SD-WAN devices in a network. These templates provide a standardized, scalable way to deploy configurations to multiple devices, ensuring consistency and reducing manual errors.</p> <p>In this lab vManage has been pre-configured with various Device and Feature Templates.  The pre-configured templates have all the configurations required for a functional SD-WAN Fabric.</p> <p>In this task we will attach cEdges (Site-100, Site-300 and Site-400) to their respective vManage Device Templates.  The <code>Attach Device</code> step of attaching a cEdge to it's Device templates is performed on the vManage GUI via a web browser.  This process simplifies network management by enabling efficient scalability and reducing manual configuration errors. It allows for quick deployment of new devices and easy updates to existing ones, all while ensuring that network settings adhere to predefined policies and standards.</p>"},{"location":"Task2/#step-1---vmanage-gui","title":"Step 1 - vManage GUI","text":"<p>Cisco SD-WAN vManage is provisioned via a web browser.  We will perform all provisioning via a Google Chrome browser on the RDP session (i.e., Jumphost)</p> <ul> <li>Logon to vManage GUI by launching <code>Google Chrome</code> web browser on the Desktop or taskbar on your RDP session (i.e., Jumphost).</li> </ul> <p></p> <ul> <li>After launching Chrome, click on <code>vManage</code> bookmark on the bookmark bar as shown below:</li> </ul> <p></p> <ul> <li>Logon to vManage using below credentials: <ul> <li>Username: <code>admin</code></li> <li>Password: <code>C1sco12345</code></li> </ul> </li> </ul>"},{"location":"Task2/#step-2---device-template-for-cedges","title":"Step 2 - Device Template for cEdges","text":"<ul> <li>After logging into vManage, click on the three bars at the top left side as shown in below screenshot: </li> </ul> <ul> <li>Then navigate to Configuration &gt; Templates as shown below: </li> </ul> <ul> <li>On the <code>Configuration - Templates</code> page, click on the <code>Device Templates</code> as shown below:</li> </ul> <p>The <code>Device Template</code> page will list various control and cEdge devices.  We will only attach the device template to their respective cEdge as per below table.  The cEdge devices can be recognized by their <code>Description</code>:</p> Description vEdge Device template of Site100-cE1 with Site ID: 100 and System IP: 1.1.10.1 Site100-cE1 Device template of Site300-cE1 with Site ID: 300 and System IP: 1.1.30.1 Site300-cE1 Device template of Site400-cE1 with Site ID: 400 and System IP: 1.1.40.1 Site400-cE1 <p> Note: Please don't add Site200-CE1 to any template </p> <ul> <li>On the <code>Device Templates</code> page, locate the Site100-cE1 device from its description and click on the the three dots (<code>...</code>) on the right side as shown below:</li> </ul> <p></p> <ul> <li>Then on <code>Attach Devices</code> page scroll down to or Search for <code>Site100-cE1</code> to select it with the Right arrow (<code>&gt;</code>) as shown below:</li> </ul> <p></p> <ul> <li>After selecting the Site100-cE1, click on <code>Attach</code>:</li> </ul> <p></p> <ul> <li>On the next page, click <code>Next</code>:</li> </ul> <p></p> <ul> <li>And lastly click on <code>Configure Devices</code> to attach the template configurations to cEdge device:</li> </ul> <p></p> <ul> <li>Wait for task to be successfull </li> </ul> <p></p> Note: Above screenshots are for <code>Site-100 cE1</code> only.  You must repeat these tasks for <code>Site300-cE1</code> and <code>Site400-cE1</code>."},{"location":"Task3-v1/","title":"Task 3 - Internet Access for All Sites","text":""},{"location":"Task3-v1/#task-introduction","title":"Task Introduction","text":"<p>In this task, our primary goal is to enable internet access for VPN-10 at Site-100. We will achieve this by routing the VPN-10 traffic through the Global Routing Table. The process involves a series of structured steps:</p> <p>1. Enabling Internet Access for VPN-10 on Site-100:  We will start by configuring Site-100 to allow VPN-10 traffic to access the internet through the Global Routing Table. This is a crucial step in ensuring that Site-100 can serve as a gateway for internet access.</p> <p>2. Propagating the Default Route:  The next significant step is to propagate a default route from Site-100 to other sites within the network (specifically Site-400 and Site-300) that are also on VPN-10. By doing this, we essentially enable Site-400 and Site-300 to use Site-100 as their default gateway on VPN-10.</p> <p>3. Routing Internet Traffic via Site-100:  Consequently, both Site-400 and Site-300 will begin routing their internet traffic through Site-100. This is achieved by efficiently utilizing the SD-WAN Fabric, which facilitates the traffic flow between these sites.</p> <p>4. Verification and Testing:  Throughout the task, we will conduct a series of verifications and tests. These are designed to ensure that each step is successfully implemented and that internet connectivity is reliably established across the sites on VPN-10.</p> <p>By the end of this task, we will have established a streamlined and efficient routing mechanism that leverages Site-100 as a pivotal access point for internet connectivity for VPN-10 across multiple sites.</p>"},{"location":"Task3-v1/#step-1--verify-no-internet-access-on-vpn-10-of-site-400-and-site-300","title":"Step 1 \u2013 Verify No Internet Access on VPN-10 of Site-400 and Site-300","text":"<p>Objective: Confirm that there is currently no internet access on VPN-10 for both Site-400 and Site-300.</p> <p>1. Launching mRemoteNG: </p> <ul> <li>On your RDP session, open the <code>mRemoteNG</code> application. This application provides access to the console of all Ubuntu machines (Virtual Machines/hosts) on the respective LANs (VPNs) of the SD-WAN sites.   </li> </ul> <p>2. Accessing Site-400's VM: </p> <ul> <li>In the <code>mRemoteNG</code> application, under <code>VNC Sessions</code>, click on <code>Site400-Ubuntu-VPN10</code>. This VM is located on the VPN-10 (LAN segment) of Site-400.   </li> </ul> <p>3. Logging into the Ubuntu VM:</p> <ul> <li>If the console is locked, click on the console screen.</li> <li>Use the following credentials to log in:</li> <li>Username: <code>ubuntu</code></li> <li>Password: <code>viptela</code></li> </ul> <p>4. Testing Internet Browser Access:</p> <ul> <li>On the Ubuntu desktop, click on the <code>Chromium Web Browser</code> icon to launch it.   </li> <li>Try accessing an internet website, such as <code>cisco.com</code>. The access should fail, indicating no internet connectivity.   </li> </ul> <p>5. Testing Network Connectivity:</p> <ul> <li>Open the <code>Terminal</code> application by clicking its icon on the desktop.</li> <li>In the Terminal, execute <code>ping 8.8.8.8</code> and press <code>Ctrl+C</code> after a few seconds to stop the ping. A failed ping with 100% packet loss indicates no internet access.   </li> </ul> <p>6. Repeating the Process for Site-300:</p> <ul> <li>Use <code>mRemoteNG</code> to access the console of <code>Site300-Ubuntu-VPN10</code>.</li> <li>Repeat the steps to verify the absence of internet access on this VM as well.</li> </ul>"},{"location":"Task3-v1/#step-2---enable-internet-on-vpn-10-of-site-100","title":"Step 2 - Enable Internet on VPN-10 of Site-100","text":"<p>Objective: Route traffic from VPN-10 on Site-100 to the Global Routing Table (GRT), also known as VPN-0, to enable internet access.</p> <p>1. Launching MTPutty: </p> <ul> <li>Start the <code>MTPutty</code> application. You can find it either on the Desktop or in the Taskbar of your RDP session (Jumphost).   </li> </ul> <p>2. Accessing Site-400 cEdge: </p> <ul> <li>Use MTPutty to SSH into <code>Site400-cE1</code> cEdge.</li> <li>Select the saved <code>Putty session</code> for Site400-cE1.</li> <li>When prompted, enter the following credentials:</li> <li>Username: <code>admin</code></li> <li>Password: <code>admin</code></li> </ul> <p>3. Verifying the Routing Table: </p> <ul> <li>Execute the command <code>show ip route vrf 10</code> to check the routing table.</li> <li>Confirm that there is no default route in VRF-10.   </li> </ul> <p>4. Configuring Default Route on Site100-cE1: </p> <ul> <li>Now, let's add a default route in VPN-10 pointing to VPN-0 on the Site100-cE1 node.</li> <li>This is done by modifying the <code>Feature Template</code> for VPN-10 in the vManage GUI.</li> </ul> <p>5. Editing Feature Template in vManage: </p> <ul> <li>Navigate to Configuration &gt; Templates on vManage.    </li> <li>Click on the <code>Feature Templates</code> tab.   </li> <li>Use the search bar to find the template named <code>VPN_10_05-09-2022_17-18-00_vedge-C8000V_1201</code>.</li> <li>Click the three dots <code>...</code> beside the template and select <code>Edit</code>.   </li> </ul> <p>6. Adding IPv4 Route: </p> <ul> <li>On the editing page, click on <code>IPv4 Route</code>.   </li> <li>Perform the following configurations in the <code>IPv4 Route</code> section:</li> <li>Click <code>New IPv4 Route</code>.</li> <li>Enter <code>0.0.0.0/0</code> in Prefix.</li> <li>Select <code>VPN</code> in Gateway.</li> <li>Choose <code>Global</code> from the dropdown menu in Enable VPN.</li> <li>Set Enable VPN to <code>On</code>.   </li> <li>Click <code>Add</code> and then <code>Update</code> to save the changes.   </li> </ul> <p>7. Applying the Configuration: </p> <ul> <li>Click <code>Next</code> to proceed with the configuration.   </li> <li>Select <code>Configure Devices</code> to push the configuration from vManage to the cEdge device.   </li> <li>Wait and confirm that the configuration push from vManage to the cEdge device is successful.   </li> </ul> <p>Result: By completing these steps, VPN-10 on Site-100 will be configured to route its internet traffic through the Global Routing Table (VPN-0), enabling internet access.</p>"},{"location":"Task3-v1/#step-3---default-route-propagation-from-site-100-on-vpn-10","title":"Step 3 - Default Route Propagation from Site-100 on VPN-10","text":"<p>Objective: Propagate the default route from Site-100 to other sites over the SD-WAN Fabric, following the configuration of VPN-10 traffic routing to the Global Routing Table (VPN-0) on Site100-cE1.</p> <p>1. Navigating in vManage: </p> <ul> <li>In vManage, go to Configuration &gt; Templates.    </li> </ul> <p>2. Accessing Device Templates: </p> <ul> <li>Click on the <code>Device Templates</code> tab.   </li> </ul> <p>3. Editing Site-100 Device Template: </p> <ul> <li>Find <code>Site-100</code> Device Template and click on the three dots (<code>...</code>) at the right side of it.   </li> </ul> <p>4. Working with Additional Templates: </p> <ul> <li>Click on <code>Additional Templates</code>.   </li> </ul> <p>5. Creating a CLI Add-on Template: </p> <ul> <li>From the <code>CLI Add-on Template</code> dropdown menu, select <code>Create Template</code>.   </li> </ul> <p>6. Configuring CLI Add-on Template: </p> <ul> <li>Enter the following information in the template:</li> <li>Template Name: <code>Default-Route-Propagation</code></li> <li>Description: <code>Default Route Propagation</code></li> <li>In the <code>CLI configuration</code> box, input:     <pre><code>router ospf 10 vrf 10\ndefault-information originate\n</code></pre></li> <li>Click <code>Save</code> after entering the commands.   </li> </ul> <p>7. Applying the Configuration: </p> <ul> <li>Click <code>Update</code>, followed by <code>Next</code>, and then <code>Configure Devices</code>.</li> <li>This step applies the configuration across the network.</li> <li>Wait for the confirmation message indicating successful configuration push by vManage and application by cEdge.   </li> </ul> <p>Result: The default route on VRF/VPN-10 is now configured and propagated from Site-100 across the SD-WAN fabric.</p>"},{"location":"Task3-v1/#step-4---verify-internet-connectivity-on-vpn-10-of-site-400","title":"Step 4 - Verify Internet Connectivity on VPN-10 of Site-400","text":"<p>Objective: Verify the successful establishment of internet connectivity on VPN-10 for both Site-400 and Site-300 following the configuration changes.</p> <p>1. Re-launching MTPutty if Needed: </p> <ul> <li>If the MTPutty application is not open, launch it again on your RDP session.   </li> </ul> <p>2. SSH/Login to cEdges: </p> <ul> <li>SSH/Login to <code>Site400-cE1</code> and <code>Site300-cE1</code> cEdges by clicking on their respective names in the saved <code>Putty sessions</code>.</li> </ul> <p>3. Verifying the Routing Table: </p> <ul> <li>Use the command <code>show ip route vrf 10</code> to verify the routing table for both nodes (Site300-cE1 and Site400-cE1).</li> <li>Confirm that both nodes are receiving the default route on VRF/VPN-10.   </li> </ul> <p>4. Checking Internet Access on Site-400: </p> <ul> <li>Log in again to the Ubuntu VM named <code>Site400-Ubuntu-VPN10</code> using the mRemoteNG application.</li> <li>Launch the <code>Chromium Web Browser</code> on the Ubuntu VM and navigate to an internet site, such as <code>cisco.com</code>.</li> <li>The internet access should now be functioning properly.   </li> </ul> <p>5. Testing Connectivity with Ping: </p> <ul> <li>Open the <code>Terminal</code> application on the Ubuntu VM.</li> <li>Issue the ping command <code>ping 8.8.8.8</code>.</li> <li>This time, the ping should be successful, indicating internet connectivity.   </li> </ul> <p>6. Performing Traceroute: </p> <ul> <li>In the Terminal application on the Ubuntu VM, execute a <code>traceroute</code> with the following command: <code>traceroute 8.8.8.8</code>.   </li> </ul> <p>7. Repeating for Site-300: </p> <ul> <li>Repeat the above steps to confirm internet access for VPN-10 of Site300.</li> <li>This involves verifying the ip route on VPN-10 on <code>Site300-cE1</code> and then checking internet connectivity on the Ubuntu VM <code>Site300-Ubuntu-VPN10</code>.</li> </ul> <p>Result: Internet connectivity on VPN-10 for Site-400 and Site-300 should now be successfully established and verifiable through the above tests.</p>"},{"location":"Task3/","title":"Task 3 - Internet Access for All Sites","text":"<p>In the Task we will enable internet access on Site-100 on VPN-10.  Further we will propagate default route from Site-100 towards Site-400 (&amp; Site-300) on VPN-10.  This default route will result in Site-400 (&amp; Site-300) to use Site-100 as default gateway on VPN-10.  </p> <p>Hence Site-400 will route internet traffic through Site-100 by sending traffic over the SD-WAN Fabric. </p>"},{"location":"Task3/#step-1--verify-no-internet-access-on-vpn-10-of-site-400-and-site-300","title":"Step 1 \u2013 Verify no internet access on VPN-10 of Site-400 and Site-300","text":"<ul> <li>On the RDP session, launch <code>mRemoteNG</code> application.  This application is used to get Console access to all of the Ubuntu machines (Virtual Machines / hosts) that are located on the respective LANs (VPNs) of the SD-WAN sites.</li> </ul> <ul> <li>To login the console of VM named <code>Site400-Ubuntu-VPN10</code>, click on it's name on <code>mRemoteNG</code> application under the <code>VNC Sessions</code>.  As the name indicates, this VM exists on VPN-10 (LAN segment) of Site-400.</li> </ul> <ul> <li> <p>The console of Ubuntu host/VM may be initially locked, click on the console and use below credentials to login to the Desktop of Ubuntu VM:</p> <p>Username: <code>ubuntu</code> Password: <code>viptela</code></p> </li> <li> <p>Launch <code>Chromium Web Browser</code> on Desktop of this Ubuntu machine by clicking on it's icon as shown below:</p> </li> </ul> <p></p> <ul> <li>Try to access internet websites such as <code>cisco.com</code>.  As expected, access to the website will fail. </li> </ul> <p></p> <ul> <li> <p>Launch <code>Terminal</code> application on the console of Ubuntu VM by clicking on it's icon on the desktop (You can also see the icon for Terminal application after the next step).</p> </li> <li> <p>On the <code>Terminal</code> application try to ping a server on internet by issuing <code>ping 8.8.8.8</code> command and press <code>Contrl+C</code> after few seconds to stop the ping.  As expected ping will fail and there will be 100% packet loss.</p> </li> </ul> <p></p> <ul> <li>Use <code>mRemoteNG</code> application to logon the console of VM named <code>Site300-Ubuntu-VPN10</code>.  Repeat the above steps to verify that there is no internet access on this Ubuntu VM as well.</li> </ul>"},{"location":"Task3/#step-2---enable-internet-on-vpn-10-of-site-100","title":"Step 2 - Enable Internet on VPN-10 of Site-100","text":"<p>Now let's enable internet access on Site-100 for VPN-10.  This is done by routing traffic from VPN-10 to the Global Routing Table (GRT) i.e., VPN-0.  </p> <ul> <li>Launch <code>MTPutty</code> application from the Desktop icon or from Taskbar of your RDP session (i.e., on Jumphost)</li> </ul> <p></p> <ul> <li> <p>On MTPutty application logon, via SSH, to <code>Site400-cE1</code> cEdge by clicking on the respective names under saved <code>Putty sessions</code>.  When prompted use below credentials for authentication:</p> <p>Username: <code>admin</code>Password: <code>admin</code></p> </li> <li> <p>Use the below command to verify routing table for both node. It can be verified from the output that there is no default route in VRF-10.</p> </li> </ul> <pre><code>show ip route vrf 10\n</code></pre> <p>Below screenshot from Site-400 confirms lack of default route on VRF/VPN-10:</p> <p></p> <p>Now on Site100-cE1 node let's add a default route in VPN-10 pointing to VPN-0 (i.e., GRT). This is done by modifying the <code>Feature Template</code> for VPN-10 on vManage GUI as per below steps.</p> <ul> <li>On vManage, navigate to Configuration &gt; Templates as shown below:</li> </ul> <p> </p> <ul> <li>Then click on <code>Feature Templates</code> tab as shown in below screenshot:</li> </ul> <p></p> <ul> <li> <p>Then on the <code>search bar</code>, search for Template name of <code>VPN_10_05-09-2022_17-18-00_vedge-C8000V_1201</code></p> </li> <li> <p>Then Click on the three dots <code>...</code> on the right side of this feature template and click <code>Edit</code> as shown below:</p> </li> </ul> <p></p> <ul> <li>On the next page click on <code>IPv4 Route</code> as shown below:</li> </ul> <p></p> <ul> <li> <p>In the <code>IPv4 Route</code> section, perform below configurations:</p> <ul> <li>Click <code>New IPv4 Route</code></li> <li>In Prefix Enter: <code>0.0.0.0/0</code></li> <li>In Gateway, select <code>VPN</code> button</li> <li>In Enable VPN select <code>Global</code> from drop down menu </li> <li>Then set Enable VPN to <code>On</code></li> </ul> <p></p> </li> <li> <p>Then set Enable VPN to <code>On</code></p> <ul> <li>Further click <code>Add</code> button</li> <li>Next, click on <code>Update</code> for these changes to be accepted</li> </ul> </li> </ul> <p></p> <ul> <li>Then click <code>Next</code> to proceed forward with configuration</li> </ul> <p></p> <ul> <li>Click <code>Configure Devices</code> at the bottom of the page to push the configuration from vManage towards cEdge:</li> </ul> <p></p> <ul> <li>Lastly, wait and verify that Config-Push from vManage to cEdge device is <code>Success</code> as shown below:</li> </ul> <p></p>"},{"location":"Task3/#step-3---default-route-propagation-from-site-100-on-vpn-10","title":"Step 3 - Default Route Propagation from Site-100 on VPN-10","text":"<p>Above step configured routing of VPN-10 traffic to Global Routing Table (VPN-0) on Site100-cE1.  Now let's also propagate default route from Site-100 towards other site over SD-WAN Fabric.</p> <ul> <li>On vManage, navigate to Configuration &gt; Templates:</li> </ul> <p> </p> <ul> <li>Then click on <code>Device Templates</code> tab:</li> </ul> <p></p> <ul> <li>Click on the three dots (<code>...</code>) at the right side of <code>Site-100</code> Device Template</li> </ul> <p></p> <ul> <li>Click on <code>Additional Templates</code> to navigate to that section as shown below:</li> </ul> <p></p> <ul> <li>From the <code>CLI Add-on Template</code> dropdown menu select <code>Create Template</code> as shown below:</li> </ul> <p></p> <ul> <li>Enter the following information (also shown in below screenshot):<ul> <li>Template Name: <code>Default-Route-Propagation</code></li> <li>Description: <code>Default Route Propagation</code></li> <li>In <code>CLI configuration</code> enter box the following commands:     <pre><code>router ospf 10 vrf 10\ndefault-information originate\n</code></pre></li> <li>And then click <code>Save</code> as shown in below screenshot:</li> </ul> </li> </ul> <p></p> <ul> <li> <p>Click <code>Update</code>, <code>Next</code> and then <code>Configure Devices</code>:</p> </li> <li> <p>Wait for <code>Success</code> message confirming that configurations are pushed by vManage and applied successfully by cEdge.</p> </li> </ul> <p></p> <p>Now a default route on VRF/VPN-10 towards Site-100 over SD-WAN fabric has been configured.</p>"},{"location":"Task3/#step-4---verify-internet-connectivity-on-vpn-10-of-site-400","title":"Step 4 - Verify Internet Connectivity on VPN-10 of Site-400","text":"<ul> <li>If MTPutty application has closed then launch it again on your RDP session:</li> </ul> <ul> <li> <p>SSH/Login to <code>Site400-cE1</code> and <code>Site300-cE1</code> cEdges by clicking on their respective names in the saved <code>Putty sessions</code></p> </li> <li> <p>Use the below command to verify routing table for both node. Both nodes (Site300-cE1 and Site400-cE1) are recevining default route on VRF/VPN-10</p> </li> </ul> <pre><code>show ip route vrf 10\n</code></pre> <ul> <li>Below screenshot from <code>Site-400</code> confirms that default route appears:</li> </ul> <p></p> <ul> <li> <p>Logon again to Ubuntu with hostname of <code>Site400-Ubuntu-VPN10</code> again on the mRemoteNG application</p> </li> <li> <p>Launch <code>Chromium Web browser</code> on the Ubuntu VM and navigate to Internet site such as <code>cisco.com</code>.  This time the internet access should work properly as shown below:</p> </li> </ul> <p></p> <ul> <li>Open <code>Terminal</code> application on the Ubuntu VM and issue below ping command: <pre><code>ping 8.8.8.8\n</code></pre></li> </ul> <p>This time the ping should be successful as shown below:</p> <p></p> <ul> <li>On the Terminal application on Ubuntu VM perform a <code>traceroute</code> using the following command:</li> </ul> <pre><code>traceroute 8.8.8.8\n</code></pre> <p></p> <ul> <li>Repeat these steps to confirm internet access for VPN-10 of Site300 (verify ip route on VPN-10 on <code>Site300-cE1</code> and then verify internet connectivity on Ubuntu VM <code>Site300-Ubuntu-VPN10</code>)</li> </ul>"},{"location":"Task4/","title":"Task 4 - Direct Internet Access for Site-300","text":"<p>In this task we will enable (local) Direct Internet Access (DIA) for Site 300. The traffic on VPN-10 will be routed locally through this DIA.  The DIA setup will allow to setup IPSec tunnels between Site-300 and Umbrella - thus providing Security from Umbrella Cloud.  The IPSec tunnel configurations and connectivity will be done in a later task.  </p>"},{"location":"Task4/#step-1---enable-dia-on-site-300-on-vpn-10","title":"Step 1 - Enable DIA on Site-300 on VPN-10","text":"<p>On node Site300-cE1, we will add a default route in VPN-10 pointing to VPN-0 (Global Routing Table).  This is done by modifying the VPN-10 template.</p> <ul> <li>On vManage, navigate to Configuration &gt; Templates as shown below:</li> </ul> <p> </p> <ul> <li>Then click on <code>Feature Templates</code> tab as shown in below screenshot:</li> </ul> <p></p> <ul> <li>Then on the <code>search bar</code>, search for Template name of <code>vpn_10_site300_ce1</code> </li> <li>After finding this template, Click on the three dots <code>...</code> on the right side of this feature template and click <code>Edit</code> as shown below:</li> </ul> <p></p> <ul> <li>Click on IPv4 Route to scroll down to the respective section</li> </ul> <p></p> <ul> <li> <p>In the <code>IPv4 Route</code> section, perform below configurations:</p> <ul> <li>Click on <code>New IP Route</code></li> <li>In Prefix:  <code>0.0.0.0/0</code></li> <li>In Gateway: <code>VPN</code></li> <li>In Enable VPN, select <code>Global</code> from drop down menu </li> </ul> <p></p> </li> <li> <p>Then set Enable VPN to <code>On</code>, and</p> <ul> <li>Further click <code>Add</code> button</li> <li>Next, click on <code>Update</code> for these changes to be accepted</li> </ul> <p></p> </li> <li> <p>Then click <code>Next</code> to proceed forward with configuration changes</p> </li> </ul> <p></p> <ul> <li>Click <code>Configure Devices</code> at the bottom of the page to push the configuration from vManage towards cEdge:</li> </ul> <p></p> <ul> <li>Lastly, wait and verify that Config-Push from vManage to cEdge device is <code>Success</code> as shown below:</li> </ul> <p></p>"},{"location":"Task4/#step-2---verify-internet-connectivity-on-site-300","title":"Step 2 - Verify Internet Connectivity on Site-300","text":"<p>After successful configuration as per pervious step, lets verify Internet connectivity on Site-300 VPN-10:</p> <ul> <li>If MTPutty application has closed then launch it again on your RDP session (Jumphost)</li> </ul> <p></p> <ul> <li> <p>Open MTPutty, SSH/login to <code>Site300-cE1</code> cEdge by clicking on its respective name in the saved <code>Putty sessions</code></p> </li> <li> <p>Use the following command to verify routing table of VPN-10 has a  default route by issuging below command on this SSH connection:</p> </li> </ul> <pre><code>show ip route vrf 10\n</code></pre> <p></p> <p>Now the packets will be routed through VPN-0/GRT on Site-300 cEdge router and not go over SD-WAN Fabric.</p> <ul> <li>Let's verify that default route on Global Routing Table (VPN-0) points to <code>10.2.6.1</code> and <code>10.1.6.1</code> by issuing below command:</li> </ul> <pre><code>show ip route\n</code></pre> <p></p> <ul> <li> <p>Using mRemoteNG application on the RDP session, logon to Ubuntu VM/hostname <code>Site300-Ubuntu-VPN10</code></p> </li> <li> <p>On Ubuntu VM open <code>Terminal</code> application, and initiate ping as per below command.  As expected ping will be successful.</p> </li> </ul> <pre><code>ping 8.8.8.8\n</code></pre> <p></p> <ul> <li>On <code>Terminal</code> application on Ubuntu VM, initiate a tracroute again for 8.8.8.8 using following command:</li> </ul> <pre><code>traceroute 8.8.8.8\n</code></pre> <p></p> <ul> <li>On this Ubuntu VM launch <code>Chromium Web browser</code> and verify that Internet access is working by navigating to <code>www.cisco.com</code> or some other website</li> </ul> <p></p>"},{"location":"Task4/#step-3---internet-connectivity-on-other-vpns","title":"Step 3 - Internet Connectivity on other VPNs","text":"<p>At this stage Direct Internet Access (DIA) is only on Site300 VPN10. There will be no internet connectivity on other VPNs. </p> <ul> <li>Verify lack of Internet connectivity on <code>Site300-Ubuntu-VPN12</code> Ubuntu host using mRemoteNG application on your RDP session (Jumphost) by using <code>Terminal</code> and <code>Chromium Web Browser</code>.  Ping and navigation to any internet website will fail on this Ubuntu VM (on VPN-12).</li> </ul>"},{"location":"Task5/","title":"Task 5: Umbrella integration with Site-300","text":"<p>In this task we will intergrate Site-300 with Cisco Umbrella.  As a result of this integration, SD-WAN Site-300 and Umbrella will have active &amp; backup IPSec tunnels and IP traffic from this site will be routed externally (Public Cloud, SaaS applications, Public Internet etc) via Umbrella.  This integration will allow to monitor and enforce Security capabilities from Umbrella cloud - this part will be done in a later task.</p>"},{"location":"Task5/#step-1---umbrella-organization-id","title":"Step 1 - Umbrella Organization ID","text":"<ul> <li>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>. It will automtically open the Umbrella dashboard and auto-login using single-sign-on.</li> </ul> Note: Click through the security warning to ignore the certificate (if prompted). <ul> <li>Umbrella organization (Org) is a separate instance of Umbrella and has its own dashboard.  An <code>Org ID</code> is used to identify each organization and for integrating Umbrella with Cisco SD-WAN.  This <code>Org ID</code> is a number and part of the Umbrella web URL and must be extracted from the URL.  This <code>Org ID</code> will be required at a later step as part of vManage configurations for Umbrella SIG integration.  Once you are logged into the Umbrella dashboard, extract <code>[Org ID]</code> from the URL in the address bar as per below syntax:</li> </ul> <pre><code>https://dashboard.umbrella.com/o/[Org ID]/#/...\n</code></pre> <p>Below figure is only an example showing <code>Org ID</code> of <code>1234567</code>:</p> <p></p>"},{"location":"Task5/#step-2---umbrella-api-key","title":"Step 2 - Umbrella API Key","text":"<p>We will generate an API token (Key, Secret) from the Umbrella dashboard, which will be used in the SD-WAN (vManage) configurations in later step. </p> <ul> <li> <p>After logging on Umbrella dashboard (as per previous step), navigate to Admin &gt; API Keys page.</p> </li> <li> <p>On this page, Click on <code>Legecy Keys</code>.  Next, click on <code>Umbrella Management</code> and then click on <code>Generate Token</code> as shown in below figures.  This will generate API <code>Key</code> and <code>Secret</code></p> </li> </ul> <p> </p> <ul> <li>You must copy both <code>Key</code> and <code>Secret</code> on a notepad - this information, along with <code>Org ID</code> in pervious step will be used later on during vManage configurations.</li> </ul> Note: You must copy both <code>Key</code> and <code>Secret</code> in a notepad.  It is only shown on this page once and will not be visible afterwards."},{"location":"Task5/#step-3---update-sig-feature-template-on-vmanage","title":"Step 3 - Update SIG Feature Template on vManage","text":"<p>Now we will add these Umbrella API credentials (<code>Key</code> &amp; <code>Secret</code>) along with <code>Org ID</code> in vManage configurations.  This will allow vManage to automate IPSec tunnel configurations as part of it's workflow.</p> <ul> <li>On vManage, navigate to Configuration &gt; Templates as shown below:</li> </ul> <p> </p> <ul> <li>Then click on <code>Feature Templates</code> tab as shown in below screenshot:</li> </ul> <p></p> <ul> <li>Then in the search bar type <code>sig</code> and find the template with name of <code>VIP23-SIG-Feature-Template</code>.  Further, click on three dots (<code>...</code>) at the right side of this feature template and click Edit as shown in below Figure:</li> </ul> <p></p> <ul> <li>Click on \"Click here to create - Cisco SIG Credentials Template\" as shown in below Figure:</li> </ul> <p></p> <ul> <li>Enter Umbrella <code>Org ID</code>, <code>Keys</code> and <code>Secret</code> that were copied &amp; saved in previous steps and then click <code>Save</code> on this page:</li> </ul> <p></p> <ul> <li>Then click <code>Update</code> at the bottom of the page:</li> </ul> <p></p> <p>After successfully saving Umbrella API Token credentials, in the next step, let's apply this Feature template to Site300-cE1 Device template so IPSec tunnels can be established between Umbrella SIG and Site300-cE1.  </p>"},{"location":"Task5/#step-4---apply-sig-feature-template-on-vmanage","title":"Step 4 - Apply SIG Feature Template on vManage","text":"<p>The previously saved SIG template will be applied to Site300-cE1 device for Umbrella SIG integration i.e. setting up IPSec tunnels with between Site300 and Umbrella cloud.</p> <ul> <li>On vManage, navigate to Configuration &gt; Templates.  And then click on <code>Device Templates</code> as shown below:</li> </ul> <p></p> <ul> <li>Search for the Site300-cE1 device in the <code>Description</code> field.  Then click on three dots (<code>...</code>) at the right side of Site300-cE1 and click Edit as shown in below Figure:</li> </ul> <p></p> <ul> <li>Once the <code>Device Template</code> is open, Click on the <code>Transport and Management VPN</code> to navigate to that section:</li> </ul> <p></p> <ul> <li>Click on <code>Cisco Secure Internet Gateway</code> to add this template to the Device.  After adding it, select its value of <code>VIP23-SIG-Feature-Template</code> from the drop-down menu as shown in below Figure:</li> </ul> <p></p> <ul> <li>Scroll all the way down to <code>Additional Templates</code> section and ensure Cisco SIG Credentials of <code>Cisco-Umbrella-Global-Credentials</code> are selected:</li> </ul> <p></p> <ul> <li> <p>Now click <code>Update</code> on this page</p> </li> <li> <p>Then click <code>Next</code> to proceed forward with configuration:</p> </li> </ul> <p></p> <ul> <li>Click <code>Configure Devices</code> at the bottom of the page to push the configuration from vManage towards cEdge:</li> </ul> <p></p> <ul> <li>Lastly, wait and verify that Config-Push from vManage to cEdge device is <code>Success</code></li> </ul> <p>Now the configurations for IPSec tunnels creation between Site-300 cEdge and Umbrella cloud are done.</p>"},{"location":"Task5/#step-5---verify-sig-tunnels","title":"Step 5 - Verify SIG Tunnels","text":"<p>In this step we will confirm that the IPSec tunnels between Umbrella cloud and SD-WAN Site-300 are UP by accessing Umbrella dashboard.</p> <ul> <li> <p>If access to Umbrella dashboard is not already open, on the RDP session, launch Google Chrome and click on <code>Umbrella SSO</code> bookmark to open up a session to Umbrella dashboard.</p> </li> <li> <p>After successful login to Umbrella Dashboard, navigate to Deployments &gt; Core Identities &gt; Network Tunnels</p> </li> </ul> <p></p> <ul> <li>It will take few minutes for tunnels to be Active.  The tunnels will remain in <code>Unestablished Tunnels</code> state initially.  After few minutes there should be 2 <code>Active Tunnels</code> as shown in below screenshot:</li> </ul> <p></p> <ul> <li> <p>Using mRemoteNG application on RDP session, launch console session of Ubuntu <code>Site300-Ubuntu-VPN10</code> host (Virtual Machine / VM).  </p> </li> <li> <p>Within the console of this Ubuntu VM, launch the Web Browser application and access website <code>welcome.umbrella.com</code>.  This is to verify if Site-300 is protected by Umbrella.  What message do you see when you try to access this website?  </p> </li> </ul> <p></p> <p>Why did it fail?</p> <p>It failed because the traffic from SD-WAN site is still routed through the normal interface and not through the IPSec tunnels.  We have to create a Service Route to redirect traffic from SD-WAN site on Umbrella SIG Tunnels towards Umbrella Cloud - this will be performed in next step.</p>"},{"location":"Task5/#step-6---redirect-traffic-to-sig-tunnels","title":"Step 6 - Redirect Traffic to SIG tunnels","text":"<p>Let's add a Service Route to SIG in order to redirect traffic from VPN-10 on Site-300 towards Umbrella cloud.</p> <ul> <li>On vManage, navigate to Configuration &gt; Templates.  And then click on <code>Feature Templates</code>:</li> </ul> <p></p> <ul> <li>In search bar type <code>vpn_10_site300_ce1</code>.  From the search results, locate this template and Click the three dots (<code>...</code>) on the right side of this template.  Then click <code>Edit</code> in the dropdown menu as shown in below Figures:</li> </ul> <p> </p> <ul> <li>On the next page, Click <code>Service Route</code> to navigate to that section:</li> </ul> <p></p> <ul> <li>Then on this section, Click on <code>New Service Route</code> and Add a route as per:</li> <li><code>Prefix</code> of <code>0.0.0.0/0</code> </li> <li><code>Service</code> of <code>SIG</code> (default setting)</li> <li>Click <code>Add</code> and then <code>Update</code> at the bottom of the page as shown in below Figure:</li> </ul> <p></p> <ul> <li> <p>Click <code>Next</code> and then click <code>Configure Devices</code></p> </li> <li> <p>Lastly, wait and verify that Config-Push from vManage to cEdge device is <code>Success</code> as shown below:</p> </li> </ul> <p></p> <ul> <li>Using mRemoteNG application on RDP session (Jumphost), launch console session of ubuntu <code>Site300-Ubuntu-VPN10</code> VM again.  Launch Chromium Web browser and check again by browsing to <code>welcome.umbrella.com</code> URL/website.  The <code>Welcome to Umbrella</code> message indicates that the site is now protected by Umbrella - specifically the traffic in VPN-10 of Site-300 is protected by Umbrella.</li> </ul> <p></p> <ul> <li>On the console session of ubuntu VM <code>Site300-Ubuntu-VPN10</code> (by using mRemoteNG application), verify traffic routing on this Site-300 by running below command:</li> </ul> <pre><code>traceroute 8.8.8.8\n</code></pre> <p>From the output of traceroute, what do you notice different to the output in earlier task on this VM/host?  (Tip: hop count etc)</p>"},{"location":"Task6/","title":"Task 6: Umbrella Policy for Site300","text":"<p>The goal of this Task is to create Umbrella Policies that will:</p> <ul> <li>Use Firewall Policy (i.e., Cloud Delivered Firewall / CDFW) on Umbrella to block any icmp traffic to Google IP address of 8.8.8.8 </li> <li>Use Web Policy (i.e., Secure Web Gateway / SWG) on Umbrella to block web traffic to social media websites.</li> </ul>"},{"location":"Task6/#step-1---firewall-policy","title":"Step 1 - Firewall Policy","text":"<p>In this step, a Firewall Policy on Umbrella Dashboard will be configured to block ICMP traffic.</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>On Umbrella dashboard, go to Policies &gt; Management &gt; Firewall Policy. At the top-right corner, click Add </p> <ul> <li>Create a Rule Name of <code>Block ICMP Google</code>. </li> <li>Under Rule Action select <code>Block</code> from drop-down menu </li> <li>Under Rule Criteria &gt; Protocol select <code>ICMP</code> as the protocol</li> <li>Further under Destinations (under Rule Criteria) select <code>Specify IP</code> from drop-down menu:<ul> <li>Enter CIDR IP Address: <code>8.8.8.8</code> </li> </ul> </li> </ul> </li> <li>Scroll down on the page and Logging Enabled and then Save the policy </li> </ul>"},{"location":"Task6/#step-2---web-policy","title":"Step 2 - Web Policy","text":"<p>In this step, we will configure an Umbrella Web Policy to block web traffic to one social media website i.e., Facebook.</p> <ul> <li> <p>On Umbrella dashboard, go to Policies &gt; Management &gt; Web Policy and click Add on the top right as shown in below screenshot: </p> </li> <li> <p>Click ADD RULE under <code>Ruleset Rules</code>. </p> </li> <li> <p>Give the Rule Name of <code>Block Facebook</code>.  The default Rule Action is <code>Block</code>.  Then click Add Identity as shown below: </p> </li> <li> <p>On the <code>IDENTITIES</code> page, scroll down, select the Network Tunnels and hit Apply as shown in below screenshot.  This will result in selecting the two network tunnels between Umbrella cloud and SD-WAN Site-300: </p> </li> <li> <p>Next, Click on Add Destination in the same <code>Add Rule</code> step: </p> </li> <li> <p>Click on Application Settings (on the right side at the right arrow &gt;), then Scroll down to <code>Social Networking</code> and Click on the right arrow &gt; of the Social Networking. </p> </li> <li> <p>Next, select Facebook and Facebook Messenger and hit Apply </p> </li> <li> <p>On the main Rule screen, Click Save at the right side of the newly created Rule: </p> </li> <li> <p>Click three dots and then Enable Rule </p> </li> <li> <p>Confirm by clicking Update </p> </li> <li> <p>Under Ruleset Settings, go to the Ruleset Identities section and click Edit </p> </li> <li> <p>Select Tunnels under <code>All Identities</code> and click Save </p> </li> <li> <p>Under Ruleset Settings, go to the HTTPS Inspection section and click Edit </p> </li> <li> <p>Select Enable HTTPS Inspection, then Save </p> </li> <li> <p>Scroll down and click Close </p> </li> </ul>"},{"location":"Task6/#step-3---web-policy-tester","title":"Step 3 - Web Policy Tester","text":"<p>Let's go through the steps to test the newly created Web policies by using \"Policy Tester\" on  Umbrella.</p> <ul> <li> <p>On Umbrella Dashboard, navigate to Policies &gt; Management Web Policy.  Click on Policy Tester at the top right corner:  </p> </li> <li> <p>On the <code>Web Policy Tester</code> page,</p> <ul> <li>Under the Primary Identity search box type <code>Site</code> and then select any of the tunnels for Site300 </li> <li>Under Destination, enter <code>facebook.com</code></li> <li>Then click Run Test button:  </li> </ul> </li> <li> <p>The result of this test appears on the page and as expected it shows the Ruleset and rule being matched by the Web policy. </p> </li> <li> <p>Explore the Web Policy Tester further by testing traffic to different destination website such as cisco.com, google.com etc.</p> </li> </ul>"},{"location":"Task6/#step-4---verify-policies","title":"Step 4 - Verify Policies","text":"<p>Now lets validate the impact of both Firewall and Web Policies from the SD-WAN Site-300.</p> <ul> <li> <p>First validate if traffic is being redirected to Umbrella.</p> <ul> <li>Launch console access to ubuntu Site300 VPN10 host by using mRemoteNG application.</li> <li>Use Chromium to navigate to <code>welcome.umbrella.com</code>. A green check mark should appear, confirming that traffic from VPN 10 is being successfully redirected to Umbrella.</li> </ul> </li> <li> <p>Verify Firewall policy enforcement on Umbrella by launching the Terminal application on Site300 VPN10 host.  As per our policy ICMP traffic to 8.8.8.8 should not be allowed.</p> <ul> <li>From the Ubuntu Host on VPN 10, use Terminal issue <code>ping 8.8.8.8</code> command.  Use <code>Ctrl+C</code> to stop the ping.  This ping should fail (as expected).</li> <li>From the Ubuntu Host on VPN 10, use Terminal issue <code>ping 1.1.1.1</code> command.  Use <code>Ctrl+C</code> to stop the ping.  This ping should fail (as expected).</li> </ul> </li> <li> <p>Verify Web Policy by using Chromium Web Browser on Site300 VPN10 host.  Just like previous step, use the console of ubuntu Site300 VPN10 host by using mRemoteNG application.</p> <ul> <li>Use Chromium to navigate onto traditional websites, such as <code>www.cisco.com</code>.  Access to this website should work.</li> <li>Use Chromium to navigate to <code>cnn.com</code>.  Access to this website should work.</li> <li>Use Chromium to navigate onto <code>www.facebook.com</code>.  As per our Umbrella Web Policy, this site should be blocked and, as expected, Cisco Umbrella block page will appear. </li> </ul> </li> </ul>"},{"location":"Task6/#step-5---block-sites-using-destination-list","title":"Step 5 - Block sites using Destination List","text":"<p>In this step we will create a destination list to block customs sites.</p> <ul> <li>Logon on ubuntu host on Site 300 and access cnn.com &amp; bbc.com</li> <li> <p>On Umbrella dashboard, navigate to Policy &gt; Policy Componenet &gt; Destination Lists and Click Add on the top right corner </p> <ul> <li>Enter Name : <code>Custom Block List</code></li> <li>On Destination List Type select Web Policy from the dropdown menu</li> <li>Enter <code>cnn.com</code> and click Add </li> <li>Verify <code>cnn.com</code> is added and Click Save </li> <li>Now Navigate to Policy &gt; Management &gt; Web Policy and expand on RuleSet 1 </li> <li>Click Add Rule </li> <li>Enter Rule name : <code>Custom List</code> and click Add Identity </li> <li>Enable Inherit Ruleset Identities and click Apply </li> <li>Click on Add Destination and then click on 1 next to Destination Lists </li> <li>Select Custom Block List and then click Apply </li> <li>Click Save to save this new rule </li> <li>Click on <code>3 Dots</code> (\u2026) on this newly created rule and toggle the Enable Rule button </li> <li>Click Update on the next message </li> </ul> </li> <li> <p>Let's verify this policy.  Launch console access to ubuntu Site300 VPN10 host by using mRemoteNG application. </p> </li> <li>Logon on ubuntu host on Site-300 and access website <code>cnn.com</code> again.  As expected this site should not be accessible anymore.</li> <li>Follow the same steps and block bbc.com and validate on Ubuntu host on site-300.</li> </ul>"},{"location":"Task7/","title":"Task 7 - Umbrella SIG for Regional sites","text":"<p>In this task, Umbrella SIG will be integrated to Site 100 will be performed.  This integration will be used to route traffic towards Umbrella and enforce Cloud Security policies for local Site 100 as well as for remote Site 400.  Recall that as per IP traffic routing (earlier task) the Internet traffic from Site 400 is also routed via Site 100.  Hence Umbrella policies from these sites will also be </p>"},{"location":"Task7/#step-1---apply-sig-templates-on-vmanage","title":"Step 1 - Apply SIG Templates on vManage","text":"<p>In this step, on vManage, the SIG template in VPN0 on the device template of node Site100-cE1 (in the Transport and Management VPN section) will be performed. </p> <ul> <li> <p>On vManage, navigate to Configuration &gt; Templates. And then Click on Device Templates </p> </li> <li> <p>Edit Site100-cE1 template </p> </li> <li> <p>Click on Transport and Management VPN </p> </li> <li> <p>Click on Cisco Secure Internet Gateway to add the template.  And then Select <code>VIP23-SIG-Feature-Template</code> from the drop-down menu. </p> </li> <li> <p>Scroll all the way down to Additional Templates section and ensure Cisco SIG Credentials of <code>VIP23-SIG-Credentials</code> are added.  </p> </li> <li> <p>Click Update on this page</p> </li> <li> <p>Click Next </p> </li> <li> <p>Click Configure Devices </p> </li> <li> <p>Wait till config push is sucessfull and the configurations are successfully pushed to Site100-cE1</p> </li> </ul>"},{"location":"Task7/#step-2---verify-sig-tunnels-on-umbrella","title":"Step 2 - Verify SIG Tunnels on Umbrella","text":"<p>After configuration of IPSec tunnels to Site100-cE1, let's validate the status of those tunnels.  We can confirm that the tunnels to Umbrella are up by accessing Umbrella dashboard on the Google Chrome via the RDP session.</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Navigate to Deployments &gt; Core Identities &gt; Network Tunnels.  Initially the tunnels will be shown in Unestablished Tunnels but after few minutes these tunnels be active and shown under Active Tunnels as show in below two screenshots:</p> </li> </ul> <p></p> <p></p>"},{"location":"Task7/#step-3---redirect-traffic-to-sig-tunnels","title":"Step 3 - Redirect Traffic to SIG tunnels","text":"<p>Now we need to direct all the VPN-10 traffic from SD-WAN site(s) via these IPSec tunnels towards Umbrella by adding a Service route on vManage</p> <ul> <li>On vManage, navigate to Configuration &gt; Templates &gt; Feature Templates. Then search for <code>VPN_10_05-09-2022_17-18-00_vedge-C8000V_1201</code> and click the three dots (\u2026) and Edit from drop-down menu to modify the template:</li> </ul> <p> </p> <ul> <li> <p>Click Service Route </p> </li> <li> <p>Click New Service Route</p> </li> <li> <p>Add a Prefix of <code>0.0.0.0/0</code> pointing to SIG. </p> </li> <li> <p>Click Add and then click Update at the bottom of the page </p> </li> <li> <p>click Next and then click Configure Devices</p> </li> <li> <p>Wait till config push is sucessfull to Site100-cE1.  </p> </li> <li> <p>Optional: you may SSH to Site100-cE1 by using MTPutty application on RDP session (Jumphost).  Validate that the service route command <code>ip sdwan route vrf 10 0.0.0.0/0 service sig</code> are pushed by vManage.</p> </li> </ul> <p>Now all the required configurations on SD-WAN are in-place to route the traffic from Site-100 and Site-400 towards Umbrella using the IPSec tunnels.  Next, the Cloud Security policies for these sites will be configured on Umbrella. </p>"},{"location":"Task8/","title":"Task 8 - Umbrella Regional Policies","text":"<p>This tasks will walk through the steps to create Web Proxy Policies that will be enforced on Site-100 and Site-400 (i.e., regional sites).  These policies will: * Block web traffic to Financial Institutions * Block web traffic to additional websites by creating custom destination list</p>"},{"location":"Task8/#step-1---umbrella-web-policy","title":"Step 1 - Umbrella Web Policy","text":"<p>In this step we will configure Umbrella Web Policy to block traffic to Financial websites from Regional sites:</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Go to Policies &gt; Management &gt; Web Policy and click Add on the top right to add a new Ruleset as shown in below screenshot:</p> </li> </ul> <p></p> <ul> <li>On the new \"Ruleset Rules\" web page, under Ruleset Settings scroll down to Ruleset identities and Click Edit as shown below:</li> </ul> <p></p> <ul> <li>Next on the Ruleset Identities web page, under <code>All Identities</code> scroll down to Tunnels and Click on number 4 with right arrow i.e., <code>4 &gt;</code> as shown below:</li> </ul> <p></p> <ul> <li>On the next page, select the two Tunnels for SITE100 and Click SAVE button as shown below: </li> </ul> <p></p> Note: You must only select SITE100 tunnels.  Do not select SITE300 tunnels in this step. <ul> <li>Under the Ruleset Settings, scroll down to HTTPS Inspection section and click Edit:</li> </ul> <p></p> <ul> <li>Select Enable HTTPS Inspection, then click Save:</li> </ul> <p> </p> <ul> <li>After adding the identities, Click ADD RULE button.  Give the Rule Name of <code>Regional - block Financial</code> and verify the <code>Rule Action</code> is <code>Block</code>:</li> </ul> <p></p> <ul> <li>Next click on Add Identity for this rule.  Enable Inherit Ruleset Identities and click Apply as shown in below figure:</li> </ul> <p></p> <ul> <li>Further on the new rule, click on Add Destination and Click on right arrow <code>&gt;</code> next to Application Settings:</li> </ul> <p></p> <ul> <li>Then scroll down to Select Financial Services and hit Apply:</li> </ul> <p></p> <ul> <li>On the Rule click on Save icon to save newly added rule as shown in below screenshot:</li> </ul> <p></p> <ul> <li>By default newly created rules are disabled.  To enable the Rule 1, click three dots (<code>...</code>) at the right side and then toggle Enable Rule as shown in below screenshot. </li> </ul> <p></p> <ul> <li>Confirm by clicking Update:</li> </ul> <p></p> <p>Now the rule and ruleset settings are all configured for Regional sites.</p> <ul> <li>Scroll down and click Close as shown in below screenshot </li> </ul>"},{"location":"Task8/#step-2---create-customs-list-web-policy","title":"Step 2 - Create Customs-list Web Policy","text":"<p>In the previous step, a web policy as per Umbrella classification of Financial services websites has been created.  Now let's create our own website list (using Umbrella <code>Destination List</code>) and then use Web policy to block web traffic to this list i.e., custom URL.  This will be done by adding a new rule under existing Ruleset for regional sites i.e., Ruleset 2.</p> <ul> <li>On Umbrella dashboard, navigate to Policy &gt; Policy Component &gt; Destination lists, click Add on the top right corner:</li> </ul> <p></p> <ul> <li> <p>Add this list as per below settings:</p> <ul> <li>List Name: <code>Custom-Filter</code></li> <li>Destination List type: <code>Web Proxy</code> (from drop-down menu)</li> <li>Destination: <code>www.cnn.com</code></li> <li> <p>Click <code>Add</code> </p> </li> <li> <p>Click Save after adding destination/domain: </p> </li> </ul> </li> <li> <p>Navigate to Policies &gt; Management &gt; Web Policy and expand on RuleSet 2 by clicking on it or by clicking down-arrow:</p> <p></p> </li> <li> <p>Let's add a new rule by clicking ADD RULE button.  Give the Rule Name of <code>Regional - block custom</code> and verify the <code>Rule Action</code> is <code>Block</code>: </p> </li> <li> <p>Next let's also use ruleset identities for this rule.  Click on Add Identity for this rule and enable Inherit Ruleset Identities and click Apply as shown in below figure:</p> </li> </ul> <p></p> <ul> <li>Further on the new rule, click on Add Destination and CLick on the right arrow  <code>&gt;</code> next to Destiniation Lists</li> </ul> <p></p> <ul> <li>Select the Custom-Filter and then click on Apply</li> </ul> <p></p> <ul> <li> <p>Click on Save on this newly created rule: </p> </li> <li> <p>By default newly created rules are disabled.  To enable the Rule 2, click three dots (<code>...</code>) at the right side and then toggle Enable Rule as shown in below screenshot. </p> </li> </ul> <p></p> <ul> <li>Confirm by clicking Update:</li> </ul> <p></p> <ul> <li>After saving the rule, You may scroll down under Ruleset settings and click on Close button.</li> </ul> <p>Now the Umbrella policies for regional sites (site-100 and Site-400) have been configured. </p>"},{"location":"Task8/#step-3---web-policy-tester","title":"Step 3 - Web Policy Tester","text":"<p>Let's go through the steps to test the newly created Web policies by using \"Policy Tester\" on  Umbrella.</p> <ul> <li> <p>On Umbrella Dashboard, navigate to Policies &gt; Management &gt; Web Policy.  Click on Policy Tester at the top right corner:  </p> </li> <li> <p>On the <code>Web Policy Tester</code> page,</p> <ul> <li>Under the Primary Identity search box type <code>Site1</code> and then select any of the Site100 tunnels </li> <li>Under Destination, enter <code>chase.com</code></li> <li>Then click Run Test button:  </li> </ul> </li> </ul> <p>The result of this test appears on the page and as expected it shows the Ruleset 2 and rule being matched by the Web policy. </p> <ul> <li>Next run a test for any of the Site100 tunnel for below destinations:<ul> <li>Under Destination, enter <code>www.cnn.com</code> </li> </ul> </li> </ul> <p>The result of this test appears on the page and as expected it shows the Ruleset 2 and rule being matched by the Web policy. </p> <ul> <li>Explore the Web Policy Tester further by testing traffic to different destination website such as cisco.com, google.com etc for Regional sites traffic.</li> </ul>"},{"location":"Task8/#step-4---verify-policies-on-hosts","title":"Step 4 - Verify Policies on Hosts","text":"<p>Now lets validate the impact of both Firewall and Web Policies from the SD-WAN Site-400 (Regional site).</p> <ul> <li> <p>First validate if traffic is being redirected to Umbrella.</p> <ul> <li>Launch console access to ubuntu Site400-VPN10 host by using mRemoteNG application.  Login with credentials of <code>viptela</code></li> <li>Use Chromium Browser to navigate to <code>welcome.umbrella.com</code>.  A green check mark should appear, confirming that traffic from VPN 10 is being successfully redirected to Umbrella.</li> </ul> </li> <li> <p>Verify Web Policy by using Chromium Web Browser on Site400-VPN10 host.  Just like previous step, use the console of ubuntu Site400 VPN10 host by using mRemoteNG application.</p> <ul> <li>Use Chromium to navigate onto traditional websites, such as <code>www.cisco.com</code>.  Access to this website should work.</li> <li>Use Chromium to navigate to <code>www.cnn.com</code>.  As per our Umbrella Web Policy, this site should be blocked and, as expected, Cisco Umbrella block page will appear.</li> <li>Use Chromium to navigate to <code>www.chase.com</code>.  As per our Umbrella Web Policy, this sites should be blocked and, as expected, Cisco Umbrella block page will appear.</li> <li>Use Chromium to navigate to <code>www.bankofamerica.com</code>.  As per our Umbrella Web Policy, this sites should be blocked and, as expected, Cisco Umbrella block page will appear.</li> <li>Use Chromium to navigate onto <code>www.facebook.com</code>.  Access to this site should work as expected</li> </ul> </li> </ul>"},{"location":"Task9/","title":"Task 9 - Monitoring on Umbrella","text":"<p>In this task reports on Cisco Umbrella will be used to monitor it's usage, traffic detection, policy enforcement and the SD-WAN integration. </p> <p>As a Pre-requisite:, all the prior tasks must be completed successfully.  These earlier tasks include integration of SD-WAN sites to Umbrella, configuraiton of Umbrella policies such as Firewall, Web etc.  The traffic monitored by Umbrella, as per those policies, will be viewed in this task.</p>"},{"location":"Task9/#step-1-traffic-from-sd-wan-sites","title":"Step 1: Traffic from SD-WAN sites","text":"<p>In this step, additional IP and Web traffic will be initiated for Umbrella monitoring.</p> <ul> <li>On the RDP session, use <code>mRemoteNG</code> application to logon the console of VM named <code>Site300-Ubuntu-VPN10</code>.  This VM exists on VPN #10 of this site.</li> <li>Launch Chromium web browser and visit the website <code>cisco.com</code>.  This website should be accessible. </li> <li>On the Chromium web browser navigate to <code>facebook.com</code>.  As per earlier configured policy, the traffic to <code>facebook.com</code> should be blocked by Umbrella on Site-300. </li> <li> <p>On the <code>mRemoteNG</code> application launch the Terminal application in the RDP session of the <code>Site300-Ubuntu-VPN10</code>.  Then initiate ICMP traffic by issuing below <code>ping</code> command.  After few seconds stop the ping by pressing <code>Control-C</code>.  A 100% success rate in the ping results confirms successful Internet connectivity through Umbrella. <pre><code>ping 1.1.1.1\n</code></pre></p> </li> <li> <p>In the same terminal of the <code>Site300-VPN10</code> host, execute the command below. After a few seconds, halt the ping by pressing <code>Control-C</code>. According to the previous configuration, Umbrella should block this traffic: <pre><code>ping 8.8.8.8\n</code></pre></p> </li> </ul> <p>Next, * On the RDP session, use <code>mRemoteNG</code> application to logon the console of VM named <code>Site400-Ubuntu-VPN10</code>.  This VM exists on VPN #10 of this site. * From the Chromium Web browser initiate traffic to <code>www.cnn.com</code> and <code>cisco.com</code>.   As per earlier task, the traffic to <code>www.cnn.com</code> should be blocked by Umbrella.  * On the <code>mRemoteNG</code> application launch the Terminal application in the RDP session of the <code>Site400-Ubuntu-VPN10</code>.  Then initiate ICMP traffic by issuing below <code>ping</code> command.  After few seconds stop the ping by pressing <code>Control-C</code>.  A 100% success rate in the ping results confirms successful Internet connectivity through Umbrella. <pre><code>ping 1.1.1.1\n</code></pre></p>"},{"location":"Task9/#step-2---activity-reports-for-web-urls","title":"Step 2 - Activity Reports for Web URLs","text":"<p>The web and other IP traffic activity from the SD-WAN branch sites over a selected time period can be viewed from <code>Activity Search</code> on Cisco Umbrella.  These reports can be filtered by various categories such as identity name, destination, source IP, etc.  </p> <ul> <li> <p>On the RDP session (jumphost), access the Umbrella web page by clicking on <code>Umbrella SSO</code> bookmark on Google Chrome browser.</p> </li> <li> <p>Go to Reporting &gt; Core Reports and click on Activity Search:</p> </li> </ul> <p></p> <p>Here you can view the result of every DNS, URL, and IP request from your various SD-WAN sites and other identities.  Browse through to view some of the past results.</p> <ul> <li> <p>Click on blue Filters button to close the filter tab and then click on Advanced button in the <code>Search</code> field/bar.  </p> </li> <li> <p>On the <code>Advanced Search</code> page, navigate to to the <code>URL</code> section and enter <code>cnn.com</code>.  Then click Apply as shown in below screenshot:</p> </li> </ul> <p></p> <p>You will now see all the search results matching URL of <code>cnn.com</code>.  Below is an example screenshot for these results (your view may be different):</p> <p></p> <p>As per these search results:</p> <ul> <li>Note that the search results shows all Web Requests related to <code>cnn.com</code> i.e., Secure Web Gateway (or Web Proxy) of Umbrella logged these requests.</li> <li>Use the Scroll bar at the bottom to move right and review the various fields such as <code>Action</code>, <code>Categories</code> and <code>Ruleset or Rule</code> fields of the results (each row) shown on this page.</li> <li>Further on the right side of each row, click on the three dots (<code>...</code>) and then click <code>View Full Details</code> to see detailed info as shown in below screenshot:</li> </ul> <p></p> <p>In summary the info in Activty search results matches the configurations performed in earlier tasks!</p> <ul> <li>Click on Advanced button in the <code>Search</code> field again.  On the <code>Advanced Search</code> page, enter <code>facebook.com</code> as the second <code>URL</code> and click Apply button as shown below:</li> </ul> <p></p> <ul> <li>View the updated Activity results.  Below screenshot is an example for such result and your data may vary:</li> </ul> <p></p> <ul> <li>In the search result, review the various fields such as <code>Action</code>, <code>Categories</code> and <code>Ruleset or Rule</code> fields of the results (each row) shown on this page and verify that results match the configurations performed in earlier tasks.</li> </ul>"},{"location":"Task9/#step-2---activity-reports-for-firewall","title":"Step 2 - Activity Reports for Firewall","text":"<p>In this task, results of Umbrella monitoring for Firewall traffic will be viewed</p> <ul> <li> <p>In the Umbrella Dashboard on Google Chrome, clear the existing <code>Advanced</code> Filter by clicking on <code>CLEAR</code> button or click on cross (<code>X</code>) next to the URL field on this page.  Thus Web filters for <code>cnn.com</code> and <code>facebook.com</code> are cleared from Activity Search page.  Alternatively, just navigate back to Reporting &gt; Core Reports &gt; Activity Search.</p> </li> <li> <p>Next, Click on Advanced button in the <code>Search</code> field/bar.</p> </li> <li> <p>On the <code>Advanced Search</code> page, navigate to the <code>IP Address</code> section, enter <code>1.1.1.1</code> and hit Apply: </p> </li> <li> <p>Now you can review the search results for all traffic related to IP address of <code>1.1.1.1</code> that is detected by Umbrella Firewall (FW).  Below is an example of this search result - your result may vary:</p> </li> </ul> <p></p> <ul> <li> <p>Next, <code>Clear</code> these search results and remove the filter for <code>1.1.1.1</code>. </p> </li> <li> <p>Create a new <code>Advanced Search</code> filter for <code>IP Address</code> of <code>8.8.8.8</code> (using the same procedure as above).  </p> </li> <li> <p>Revew the search results IP address of <code>8.8.8.8</code>.  Below is an example of screenshot for this search (note your result may be different).  As per <code>Actions</code> field, you will see both <code>Allowed</code> and <code>Blocked</code>.  Why do you see both of these actions?  </p> </li> </ul> <p>Tip: Have a look at details of these packets by clicking on <code>view Full Details</code> and then review the <code>Protocol</code> field (ICMP, UDP)!</p> <p></p>"},{"location":"Task9/#step-3---top-destinations-reports","title":"Step 3 - Top Destinations Reports","text":"<p>In this step we will view the traffic to most active destinations on Umbrella Dashboard. </p> <ul> <li> <p>On Umbrella Dashboard, navgiate to Reporting &gt; Additional Reports &gt; Top Destinations.  It will show the most visited destinations.   </p> </li> <li> <p>In previous tasks, on Ubuntu Virtual Machines at the SD-WAN sites, you had browsed to various websites.  As Ubuntu VM settings the DNS queries will be routed via DNS Resolver with IP address of <code>1.1.1.1</code>.  Below Figure shows an example screenshot from a lab system.  Note: Your screen may not have the same output. Click on <code>1.1.1.1</code> among the list of destinations as shown below:</p> </li> </ul> <p></p> <ul> <li>Once <code>1.1.1.1</code> is clicked it will show below screenshot.  Click on <code>VIEW 1.1.1.1 IN INVESTIGATE</code> to view more details of this IP address as shown below</li> </ul> <p></p> <ul> <li>The investigate page shows more details about this IP address as shown in below screenshot.  Click on Talos to view the reputation and other intelligence from Cisco Talos about this IP address. </li> </ul> <p>Here is the screenshot from Cisco Talos about this IP address </p>"},{"location":"Task9/#optional-step-4---additional-reports","title":"Optional Step 4 - additional reports","text":"<p>If you have time then you can proceed to view various other reports on Umbrella Dashboard:</p> <ul> <li> <p>Navigate to Reporting &gt; Additional Request &gt; Top Identities to view the traffic by various Identities.  As expected, the Network tunnels (four) will be shown here.  <code>Allowed</code> or <code>Blocked</code> Responses by specific Traffic type can also be viewed on this page by clicking under the <code>Responses</code>.   You can vew the Tunnel and site with most traffic and the respective count (i.e. number of <code>Requests</code>) in your lab pod on this page.</p> </li> <li> <p>Navigate to Reporting &gt; Additional Request &gt; Total Request to view Traffic by type (<code>Firewall</code>, <code>DNS</code>, <code>Web</code>, All) and Responses (<code>Allowed</code>, <code>Blocked</code>).  You can check for Allowed or Blocked by Traffic type can be viewed on this page by clicking under the <code>Responses</code> </p> </li> <li> <p>Navigate to Reporting &gt; Additional Request &gt; Top Categories to view the traffic by various categories such as Advertisements, Search Engines etc.  Note traffic size and number of requests by various categories is shown in these reports.</p> </li> </ul> <p>This concludes the task for using some of the Umbrella monitoring capabilities.</p>"},{"location":"Task9/#well-done-","title":"Well Done! ##","text":""},{"location":"Topology/","title":"Topology","text":""}]}