{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"LTRENT-2387","text":"<p>Welcome to Cisco Live LTRENT-2387 - Harnessing SD-WAN for Safe Cloud Adoption: Unlocking Cloud Security</p> <p>For full documentation visit Cisco Live.</p>"},{"location":"#speakers","title":"Speakers","text":"<ul> <li>Faisal Chaudhry <code>Distinguished Architect, Cisco CX</code></li> <li>Khurram Afzal <code>Solution Architect, Cisco CX</code></li> </ul>"},{"location":"IP-Users/","title":"IP Users","text":"<p>#Address Plan, Connection Details and Credentials</p>"},{"location":"IP-Users/#wan-edges---internal","title":"WAN Edges - Internal","text":"Node System IP Site ID VPN 10 Loopback10 Site100-cE1 1.1.10.1 100 100.110.10.1 Site200-cE1 1.1.20.1 200 100.110.20.1 Site300-cE1 1.1.30.1 300 100.110.30.1 Site400-cE1 1.1.40.1 400 100.110.40.1 <p>##WAN Edges \u2013 External</p> Node MPLS TLOC (Gi2) Internet TLOC (Gi1) VPN 10 LAN (Gi3) VPN 12 LAN (Gi3) Site100-cE1 10.1.2.2/24 10.2.2.2/24 10.10.1.1/24 - Site200-cE1 10.1.4.2/24 10.2.4.2/24 10.20.1.1/24 - Site300-cE1 10.1.6.2/24 10.2.6.2/24 10.30.1.1/24 10.32.1.1/24 Site400-cE1 10.1.7.2/24 10.2.7.2/24 10.40.1.1/24 10.42.1.1/24 <p>##Controllers |Node|  System  |Site ID| |\u2014|\u2014|\u2014| |vManage|   1.1.1.1|    1| |vBond| 1.1.1.2|    -| |vSmart-1|1.1.1.3|  1| |vSmart-2|1.1.1.4|  1|</p> <p>##3rd Party Devices |Node|  Type|   Site|   VPN ID |    IP address| |\u2014|\u2014|\u2014|\u2014|\u2014| |Site300-Ubuntu-VPN10|  Host|   300 |10 |10.30.1.10/24| |Site300-Ubuntu-VPN12|  Host|   300 |12|10.32.1.10/24| |Site400-Ubuntu-VPN10|  Host|   400|10  |10.40.1.10/24| |Site400-Ubuntu-VPN12|  Host|   400 |12 |10.42.1.10/24|</p> <p>##UI Credentials and Connection Details |Node|  IP|Port|Username|Password| |\u2014|\u2014|\u2014|\u2014|\u2014| |vManage|   198.18.133.200|8443|    admin   |C1sco12345| |Site300-Ubuntu-VPN10|198.18.133.200|30503|ubuntu|viptela| |Site300-Ubuntu-VPN12|198.18.133.200|30504|ubuntu|viptela| |Site400-Ubuntu-VPN10|198.18.133.200|30501|ubuntu|viptela| |Site400-Ubuntu-VPN12|198.18.133.200|30500|ubuntu|viptela|</p> <p>##SSH Credential and Connection Details |Node|  IP|Port|Username|Password| |\u2014|\u2014|\u2014|\u2014|\u2014| |vManage|198.18.133.200|19001|admin|C1sco12345| |vBond|198.18.133.200|19002|admin|admin| |vSmart-1|198.18.133.200|19003|admin|admin| |vSmart-2|198.18.133.200|19005|admin|admin| |Site100-cE1|198.18.133.200|19007|admin|admin| |Site200-cE1|198.18.133.200|19011|admin|admin| |Site300-cE1|198.18.133.200|19017|admin|admin| Site400-cE1|198.18.133.200|19021|admin| admin|</p>"},{"location":"Task1-Connect/","title":"Task 1 - VPN connection","text":"<p>Your first task will log on to remote lab using VPN.  At the end of this task, you will have a fully network connectivity to a remote server using Remote Desktop.</p>"},{"location":"Task1-Connect/#step-1-connect-to-lab-using-anyconnect-vpn","title":"Step 1: Connect to lab using anyconnect VPN","text":"<p>You will connect to remote Lab using Cisco VPN AnyConnect client, as shown in below picture.</p> <ul> <li>Launch the Cisco VPN AnyConnect client from your PC</li> <li>Enter the remote server for your pod as provided by Lab Speakers.         * This remote server will be <code>dcloud-sjc-anyconnect.cisco.com</code> or <code>dcloud-rtp-anyconnect.cisco.com</code> </li> <li> <p>The <code>username</code> and <code>password</code> credentials for this VPN connection will also be provided by the lab admin </p> <p>Note: lab admin will furnish the credentials information to each participant.  If you don't have this information please ask the lab speakers.</p> <p></p> <p>Below is an example of user logging into a reference pod in <code>dcloud-sjc-anyconnect.cisco.com</code>:</p> <p></p> </li> <li> <p>Hit accept when the prompt appears to accept the VPN connection login    </p> <p></p> </li> </ul> <p>Note: credentials used in above screenshot are provided as an example only.  Credentials for each pod will be provided by the lab speakers.</p>"},{"location":"Task1-Connect/#step-2-rdp-to-workstation","title":"Step 2: RDP to workstation","text":"<p>In this step, you will connect to the workstation with Remote Desktop (RDP) client on your machines.  Use below details for this RDP session:</p> <ul> <li>Workstation/Computer: <code>198.18.133.36</code></li> <li>Username: <code>Admin</code></li> <li>Password: <code>C1sco12345</code></li> </ul> <p>Below screenshot is only an example for this RDP connection: </p> <p>Note:  above screenshot is provided as an example only.  </p>"},{"location":"Task1-Connect/#step-3-mtputty-and-browser","title":"Step 3: MTPutty and Browser","text":"<p>Once you have the RDP session to the remote workstation, then you will use MTputty client (pre-installed on the remote workstation) and Chrome Browser to connect to all devices in this lab. </p> <p>MTputty is already installed on the Desktop of the workstation where you connected using RDP.  Run this application by clicking on the icon on the desktop:</p> <p></p>"},{"location":"Task10/","title":"Task 10 - Block Page","text":"<p>This tasks will walk through the steps to modify the Block page that is shown to users when a Web policy is enforced on Site-100 and Site-400 (i.e., regional sites).  </p>"},{"location":"Task10/#step-1---umbrella-web-policy","title":"Step 1 - Umbrella Web Policy","text":"<p>In this step we will configure a new block page.</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Navigate to Policies &gt; Policy Components &gt; Block Page Appearance.  Then click Add on the top right to add a new Block page as shown in below screenshot:</p> </li> </ul> <p></p> <ul> <li>On the <code>Add New Block Page Appearance</code> web page, configure the below settings:<ul> <li>Name: <code>Block Page Regional</code></li> <li>Click on <code>Block Page Appearance</code> to expand it's settings</li> <li>Click on <code>Show a block page with a custom message</code></li> <li>In the text box, enter text of <code>Regional Block Page</code> (You may enter your own text here!)</li> <li>Click <code>Save</code> at the bottom right</li> </ul> </li> </ul> <p></p> <ul> <li>On Umbrella dashboard, navigate to Policies &gt; Management &gt; Web Policy and click on previously configured <code>Ruleset 2</code></li> </ul> <p></p> <ul> <li>On the Rule 2 page, navigate to Ruleset Settings and scroll down to Block Page setting and click <code>Edit</code>:</li> </ul> <p></p> <ul> <li>On the <code>Block page</code> select Custom Appearance and then select <code>Block Page Regional</code> from the dropdown menu and click Save: </li> </ul> <p></p> <ul> <li>Now the newly created <code>Block Page Regional</code> should appear for under the Settings of <code>Ruleset 2</code>:</li> </ul> <p></p>"},{"location":"Task10/#step-2---verify-new-block-page","title":"Step 2 - Verify new Block Page","text":"<p>Now lets validate that the new Block page is working for SD-WAN Site-400 (Regional site).</p> <ul> <li>Launch console access to ubuntu Site400-Ubuntu-VPN10 host by using mRemoteNG application.  Login with credentials of <code>viptela</code></li> <li>Use Chromium Browser to navigate onto traditional websites, such as <code>www.cisco.com</code>.  Access to this website should work.</li> <li>Use Chromium Browser to navigate to <code>www.chase.com</code>.  As per our Umbrella Web Policy, this sites should be blocked and, as expected, the newly created Umbrella block page will appear.</li> </ul> <p>Now lets validate that the original Block page is shown for SD-WAN Site-300.</p> <ul> <li>Launch console access to ubuntu Site300-Ubuntu-VPN10 host by using mRemoteNG application.  Login with credentials of <code>viptela</code></li> <li>Use Chromium Browser to navigate onto traditional websites, such as <code>www.cisco.com</code>.  Access to this website should work.</li> <li>Use Chromium Browser to navigate to <code>www.cnn.com</code>.  As per our Umbrella Web Policy, this sites should be blocked and, as expected, the original block page will appear.</li> </ul>"},{"location":"Task11/","title":"Task 11 - Data Loss Prevention","text":"<p>Umbrella Data Loss Prevention (DLP) policy helps to protect sensitive data uploaded to the web. It discovers and protects sensitive data stored being exposed outside of an organization.  </p> <p>This tasks will walk through the steps to create policy (called Real Time DLP Rule) that will monitor the web proxy traffic and then allow administrators to decide if the content should only be monitored or blocked.  In this case policy to monitor, and then block, files for General Data Protection Regulation (GDPR) classification will be configured.  The General Data Protection Regulation (GDPR) is a regulation in EU law on data protection and privacy.  Files with personal information such as names, addresses, phone numbers etc must be handled with care.  A sample file will be used to test the compliance of GDPR regulation i.e., monitoring and then enforcing/blocking.</p>"},{"location":"Task11/#step-1---umbrella-dlp-monitor-policy","title":"Step 1 - Umbrella DLP Monitor Policy","text":"<p>In this step we will configure a DLP rule for monitoring GDPR compliance.</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Navigate to Policies &gt; Management &gt; Data Loss Prevention Policy.  Then click Add Rule on the right pane and select <code>Real Time Rule</code> to add a new DLP Policy as shown in below screenshot:</p> </li> </ul> <p></p> <ul> <li>On the <code>Add New Real Time Rule</code> web page, configure the below settings and as shown in below screenshots<ul> <li><code>Rule Name</code>: <code>DLP GDPR</code></li> <li>From the <code>Severity</code> dropdown menu select <code>Medium</code></li> <li>In <code>Data Classifications</code> section, select <code>Built-in GDPR classification</code>.  Note you can click <code>Preview</code> to view the Data Identifiers</li> <li>In the <code>Identities</code>, select <code>Tunnels</code> to use the traffic from all SD-WAN sites</li> <li>In the <code>Destination</code> section, click on <code>All Destinations</code></li> <li>Within <code>Action</code> section, select <code>Monitor</code> from the dropdown menu</li> <li>Click <code>Save</code> at the bottom right</li> </ul> </li> </ul> <p> </p> <p>Now the DLP policy to inspect (Monitor) the compliance of GDPR data has been configured.</p>"},{"location":"Task11/#step-2---sample-file-for-dlp","title":"Step 2 - Sample file for DLP","text":"<p>In this step a sample file to test the previously configured DLP policy will be downloaded on a VM with hostname of Site300-Ubuntu-VPN10 on SD-WAN site-300.  This file has sample data that includes items such as Name, Birth date, Gender, address etc.  If this file is published to cloud, then this data in file will result in raising a compliance alarm on Umbrella, as per our policy.</p> <ul> <li> <p>Launch console access to ubuntu Site300-Ubuntu-VPN10 host by using mRemoteNG application.  Login with credentials of <code>viptela</code>.</p> </li> <li> <p>Use Chromium Browser on this VM to navigate onto website with URL of <code>dlptest.com/sample-data</code>.  </p> </li> <li> <p>Scroll (down) to <code>Sample SSN and CCN Files</code> on this website and then click to download <code>CSV File</code> as shown in below figure.  This file will be automically saved on the <code>Downloads</code> folder on the VM.</p> </li> </ul> <p></p> <p>Now we have the sample file available on our host VM to test it.</p>"},{"location":"Task11/#step-3---validate-dlp-monitor-policy","title":"Step 3 - Validate DLP Monitor Policy","text":"<p>Now validate this DLP policy by publishing this file.  Umbrella will detect the GDPR compliance data violation as per our policy and raise an event in it's reporting.</p> <ul> <li> <p>Launch console access to ubuntu Site300-Ubuntu-VPN10 host by using mRemoteNG application.  Login with credentials of <code>viptela</code></p> </li> <li> <p>Use Chromium Browser to navigate to website: <code>dlptest.com/http-post/</code> </p> </li> <li> <p>On this web page, on Chromium Browser, navigate to <code>File Upload *</code> section.  Click on <code>Drop a file here or click to upload</code> as shown in below screenshot:</p> </li> </ul> <p></p> <ul> <li>On the <code>Open Files</code> page, click on <code>Downloads</code>, then click on <code>sample-data.csv</code> and click <code>Open</code> to upload the file:</li> </ul> <p></p> <ul> <li>The file will be uploaded successfully.  You will see the message as shown in below screenshot</li> </ul> <p></p> <p>Now let's navigate to Umbrella to check if a compliance alarm was raised as per our policy.</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Navigate to Reporting &gt; Additional Reports &gt; Data Loss Prevention.  On the right pane, you should see an <code>Event Type</code> of <code>Real Time</code> with <code>Severity</code> of <code>Medium</code> and other details related to the File upload to <code>DLP Test</code> website.  </p> </li> <li> <p>Further on the right side of each row, click on the three dots (<code>...</code>) and then click <code>View Full Details</code> to check the various GDPR related violations detected by Umbrella.  Below is a sample screenshot for such event, your view may be little different.</p> </li> </ul> <p></p> <p>This event confirms that Umbrella has detected the compliance violation.</p>"},{"location":"Task11/#step-4---umbrella-dlp-block-policy","title":"Step 4 - Umbrella DLP Block Policy","text":"<p>Now let's modify the existing DLP policy to Block (instead of Monitor) the content in case of breach of GDPR compliance</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Navigate to Policies &gt; Management &gt; Data Loss Prevention Policy.   One DLP Rule should appear on the right pane.  Click on the three dots (\u2026) on the right side as shown in below screenshot and then click Edit Rule:</p> </li> </ul> <p></p> <ul> <li>On the <code>Edit Real Time Rule</code> scroll down to the <code>Action</code> section and select the action of <code>Block</code> from the dropdown menu and click <code>Save</code>:</li> </ul> <p></p> <p>Now this rule has been edited with block action instead of just monitor.</p>"},{"location":"Task11/#step-5---validate-dlp-block-policy","title":"Step 5 - Validate DLP Block Policy","text":"<p>Now validate this DLP policy by publishing the test file previously downloaded on VM/host on Site300.  Umbrella will detect the GDPR compliance data violation as per our policy and block uploading of this file.</p> <ul> <li> <p>Launch console access to ubuntu Site300-Ubuntu-VPN10 host by using mRemoteNG application.  Login with credentials of <code>viptela</code></p> </li> <li> <p>Use Chromium Browser to navigate to website: <code>dlptest.com/http-post/</code>.  If you already have this webiste open on Chromium Browser, you must refresh the browser to navigate on to this page again.</p> </li> <li> <p>On this web page, on Chromium Browser, navigate to <code>File Upload *</code> section.  Click on <code>Drop a file here or click to upload</code> as done in previous step in this task.</p> </li> <li> <p>On the <code>Open Files</code> page, click on <code>Downloads</code>, then click on <code>sample-data.csv</code> and click <code>Open</code> to upload the file</p> </li> <li> <p>The file upload will fail.  You will see the message as shown in below screenshot</p> </li> </ul> <p></p> <p>Now let's navigate to Umbrella to check if a compliance event was raised as per our policy.</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Navigate to Reporting &gt; Additional Reports &gt; Data Loss Prevention.  On the right pane, you should see an <code>Event Type</code> of <code>Real Time</code> with <code>Severity</code> of <code>Medium</code> and other details related to the File upload to <code>DLP Test</code> website.  This event should have an action of <code>Blocked</code></p> </li> <li> <p>Further on the right side of each row, click on the three dots (<code>...</code>) and then click <code>View Full Details</code> to check the various GDPR related violations detected by Umbrella.  Below is a sample screenshot for such block event, your view may be little different.</p> </li> </ul> <p></p> <p>This event confirms that Umbrella has detected the compliance violation and resulted in Blocking the upload of this file. </p>"},{"location":"Task2/","title":"Task 2 - vManage Device Features","text":"<p>#Task 2 - Device Templates</p> <p>In this Task we will add cEdeges to their respective Device templates.</p> <ul> <li> <p>Attach vEdge to Device Templates</p> <ul> <li>Logon to vManage GUI</li> <li>Open Chrome and click vManage on Boookmark Bar</li> </ul> </li> <li> <p>Logon to vManage using credential provided</p> <ul> <li>Username: <code>admin</code></li> <li>Password: <code>C1sco12345</code></li> </ul> </li> </ul> <p> </p> <ul> <li>On vManage, navigate to Configuration&gt;Templates&gt; Device Template </li> <li>Attach only following device template to their respective vEdge</li> </ul> Description vEdge Device template of Site100-cE1 with Site ID: 100 and System IP: 1.1.10.1 Site100-cE1 Device template of Site300-cE1 with Site ID: 300 and System IP: 1.1.30.1 Site300-cE1 Device template of Site400-cE1 with Site ID: 400 and System IP: 1.1.40.1 Site400-cE1 <p> Note: Please don't add Site200CE1 to any template </p> <p> </p> <ul> <li>Wait for task to be successfull  </li> </ul>"},{"location":"Task3/","title":"Task 3 - Regional Internet Access for All Sites","text":"<p>In the Task we will enable regional internet access for Site 300 and 400 on VPN 10 using Site 100 as gateway.</p>"},{"location":"Task3/#step-1--verify-internet-access-on-site300-and-site-400-vpn-10","title":"Step 1 \u2013 Verify internet access on Site300 and Site 400 VPN 10","text":"<ul> <li> <p>On the RDP session, use <code>mRemoteNG</code> application to logon the console of VM named <code>Site300-Ubuntu-VPN10</code>.  This VM exists on VPN #10 of this site.  Access the Console of this Ubuntu machine (on VPN 10 segment of site 300) using mRemoteNG.</p> </li> <li> <p>Initially the console may be locked, click on the console and use below credentials to log on:</p> <p>Username: <code>ubuntu</code>Password: <code>viptela</code></p> </li> </ul> <p></p> <p></p> <ul> <li>Open Chromium Browser on Desktop of this Ubuntu machine and try to access internet website such as <code>cisco.com</code>.  As expected, access to these websites will fail. </li> </ul> <p></p> <p></p> <ul> <li>Open terminal and try to ping <code>8.8.8.8</code> and press <code>Contrl+C</code> after few seconds to stop the ping.  As expected there will be 100% packet loss.</li> </ul> <p></p> <ul> <li>Use <code>mRemoteNG</code> application to logon the console of VM named <code>Site400-Ubuntu-VPN10</code>.  Repeat the above steps to verify that there is no internet access on this Ubuntu VM on Site400 in VPN10. </li> </ul>"},{"location":"Task3/#step-2---enable-internet-on-site100-vpn10","title":"Step 2 - Enable Internet on Site100 VPN10","text":"<ul> <li> <p>Open mPutty and logon to Site300-cE1 and Site400-cE1 vEdges</p> <p>Username: <code>admin</code>Password: <code>admin</code></p> </li> </ul> <p></p> <ul> <li>Use the following command to verify routing table for both node. Note: There is no default route on vrf 10.</li> </ul> <p><code>show ip route vrf 10</code></p> <p></p> <p>\u2013 On node Site100-cE1, add a default route in VPN 10 pointing to VPN 0. This is done by modifying the VPN10 template on vManage GUI as per below steps.</p> <ul> <li>On vManage, navigate to Configuration &gt; Templates &gt; Feature Templates tab.</li> </ul> <p> </p> <p></p> <ul> <li> <p>Then on the search bar, search for </p> <ul> <li>Template name : <code>VPN_10_05-09-2022_17-18-00_vedge-C8000V_1201</code> </li> <li>Click on the three dots <code>...</code> and then Edit as shown below</li> </ul> </li> </ul> <p></p> <ul> <li> <p>Click on IPv4 Route     </p> <ul> <li>Click New IPv4 Route</li> <li>In Prefix enter:  0.0.0.0/0</li> <li>In Gateway, select VPN button</li> <li>In Enable VPN select Global from drop down menu.   </li> <li>Then set Enable VPN to On</li> </ul> <p></p> <ul> <li>Then set Enable VPN to On</li> <li>Further click Add </li> <li>Next, click on update for these changes to be accepted</li> </ul> </li> </ul> <p></p> <ul> <li>Click Next</li> </ul> <p></p> <ul> <li>Click Configure Devices at the bottom of the page</li> </ul> <p></p> <ul> <li>Verify Config-Push is successful </li> </ul> <p></p>"},{"location":"Task3/#step-3---default-route-propagation-using-cli-template","title":"Step 3 - Default Route Propagation Using Cli Template","text":"<ul> <li>On vManage, navigate to Configuration&gt;Templates&gt;Device Templates</li> </ul> <ul> <li>Click on the three dots (<code>...</code>) at the right side of Site-100 Device Template</li> </ul> <ul> <li>Click on Additional Templates</li> </ul> <ul> <li>On CLI Add-on Template dropdown menu select Create Template</li> </ul> <ul> <li> <p>Enter the following information</p> <ul> <li>Template Name : <code>Default-Route-Propagation</code></li> <li>Description : <code>Default Route Propagation</code></li> </ul> </li> <li> <p>In CLI configuration box paste the following commands</p> </li> </ul> <pre><code>router ospf 10 vrf 10\n default-information originate\n</code></pre> <ul> <li>Click Save</li> </ul> <p></p> <ul> <li> <p>Click Update and then Configure Device</p> </li> <li> <p>Wait for task to be successfull  </p> </li> </ul>"},{"location":"Task3/#step-3---verify-internet-connectivity-on-site300-and-site400-vpn10","title":"Step 3 - Verify Internet Connectivity on Site300 and Site400 VPN10","text":"<ul> <li>Open mPutty and logon to Site300-cE1 and Site400-cE1 vEdges</li> </ul> <ul> <li>Use the following command to verify routing table for both node. Both nodes (Site300-cE1 and Site400-cE1) are recevining default route on vrf 10</li> </ul> <p><code>show ip route vrf 10</code></p> <p></p> <ul> <li> <p>Logon again to Ubuntu on Site300 VPN10 </p> </li> <li> <p>Open browser, Internet access should now be possible.</p> </li> </ul> <p></p> <ul> <li>Open Terminal, and ping 8.8.8.8. Ping is successful.</li> </ul> <p></p> <ul> <li>On terminal do a traceroute to 8.8.8.8, use the following command</li> </ul> <p><code>traceroute 8.8.8.8</code></p> <p></p> <ul> <li>Verify again for Site400 VPN10</li> </ul>"},{"location":"Task4/","title":"Task 4 - Direct Internet Access for Site300","text":"<p>In this task we will enable local Direct Internet Access for Site 300 </p>"},{"location":"Task4/#step-1---enable-dia-on-site300-vpn10","title":"Step 1 - Enable DIA on Site300 VPN10","text":"<p>On node Site300-cE1, add a default route in VPN 10 pointing to VPN 0 (Global Routing Table). This is done by modifying the VPN10 template.</p> <ul> <li>On vManage, navigate to Configuration &gt; Templates &gt; Feature Templates</li> </ul> <p> </p> <p></p> <ul> <li> <p>Then on the search bar, search for <code>vpn_10_site300_ce1</code> </p> <ul> <li> <p>Click on IPv4 Route and enter following values </p> </li> <li> <p>Click New IP Route</p> </li> <li>Prefix :  0.0.0.0/0</li> <li>Gateway : VPN</li> <li>Enable VPN : Click on grey tick and select Global </li> </ul> <p></p> <ul> <li> <p>Enable VPN : On </p> </li> <li> <p>Click Add and then Click Update at the bottom of page</p> </li> </ul> </li> <li> <p>Click Next</p> </li> </ul> <p></p> <ul> <li>Click Configure Devices</li> </ul> <p></p> <ul> <li>Verify Config-Push is successful </li> </ul> <p></p>"},{"location":"Task4/#step-2---verify-internet-connectivity-on-site300-vpn10","title":"Step 2 - Verify Internet Connectivity on Site300 VPN10","text":"<p>_ - Open mPutty and logon to Site300-cE1 cEdge using SSH:</p> <p></p> <ul> <li>Use the following command to verify routing table and the default route on vrf 10:</li> </ul> <pre><code>show ip route vrf 10\n</code></pre> <p></p> <ul> <li>Further verify that default route on Global Routing Table (VPN 0) points to <code>10.2.6.1</code> and <code>10.1.6.1</code> by issuing below command:</li> </ul> <pre><code>show ip route vrf\n</code></pre> <p></p> <ul> <li> <p>Using mRemoteNG application on the RDP session, Logon again to Ubuntu on Site300 VPN10</p> </li> <li> <p>On Ubuntu VM launch the Web browser and verify that Internet access is working.</p> </li> </ul> <p></p> <ul> <li>On Ubuntu VM open Terminal application, and initiate ping to 8.8.8.8 as per below command.  As expected ping will be successful. <pre><code>ping 8.8.8.8\n</code></pre></li> </ul> <p></p> <ul> <li>On Terminal application on Ubuntu VM, initiate a tracroute again for 8.8.8.8 using following command. Now the packets are going direclty to internet from Site-300 cEdge router</li> </ul> <pre><code>traceroute 8.8.8.8\n</code></pre> <p></p>"},{"location":"Task4/#step-3---verify-internet-connectivity-on-other-vpns","title":"Step 3 - Verify Internet Connectivity on Other VPNs","text":"<p>At this stage direct Internet access is only on Site300 VPN10. There is no internet connectivity on other VPNs. </p> <ul> <li>Verify lack of Internet connectivity on Site300 VPN12 Ubuntu host using mRemoteNG application on RDP</li> </ul>"},{"location":"Task5/","title":"Task 5: Umbrella (SIG) for Site300","text":"<p>In this task we will enable intergration Site 300 with Cisco Umbrella.</p>"},{"location":"Task5/#step-1---umbrella-configuration","title":"Step 1 - Umbrella Configuration","text":"<ul> <li>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>. It will open the Umbrella dashboard and auto-login using single-sign-on.</li> </ul> Note: Click through the security warning to ignore the certificate (if prompted). <ul> <li>Umbrella organization (Org) is a separate instance of Umbrella and has its own dashboard.  An <code>Org ID</code> is used to identify each organization and for integrating Umbrella with Cisco SD-WAN.  This <code>Org ID</code> is a number and part of the Umbrella web URL and must be extracted from the URL.  This ID will be required at a later step as part of vManage configurations for Umbrella SIG integration.  Once you are logged into the Umbrella dashboard, extract <code>Org ID</code> from the URL in the address bar as per below syntax:</li> </ul> <pre><code>https://dashboard.umbrella.com/o/&lt;Org ID&gt;/#/&lt;page&gt;\n</code></pre> <ul> <li> <p>On Umbrella, navigate to Admin &gt; API Keys</p> </li> <li> <p>Generate API <code>Key</code> and <code>Secret</code> by clicking on Legecy Keys.  Further, click on Umbrella Management and then click on Generate Token.  Then copy both <code>Key</code> and <code>Secret</code> on a notepad - this information will be used in next step.</p> </li> </ul> <p> </p> Note: You must copy both Key and Secret in a notepad.  It is only shown at this stage and not visible afterwards."},{"location":"Task5/#step-2---update-sig-template","title":"Step 2 - Update SIG Template.","text":"<ul> <li>On vManage, navigate to Configuration &gt; Templates &gt; Feature Templates, and then in the search bar type <code>sig</code> and find the template with name <code>VIP23-SIG-Feature-Template</code>.  Further, click on three dots (\u2026) at the right side and click Edit as shown in below screenshots:</li> </ul> <ul> <li> <p>Click on \"Click here to create - Cisco SIG Credintial Template\" </p> </li> <li> <p>Enter Umbrella <code>Org ID</code>, <code>Keys</code> and <code>Secret</code> saved in previous step and click Save. </p> </li> <li> <p>Then click Update at the bottom of the page: </p> </li> </ul>"},{"location":"Task5/#step-3---apply-sig-template","title":"Step 3 - Apply SIG Template","text":"<p>This SIG template in VPN0 will be applied to Site300-cE1 for Umbrella SIG integration i.e. setting up IPSec tunnels with between Site300 and Umbrella cloud.</p> <ul> <li> <p>Navigate to Configuration &gt; Templates &gt; Device Templates. </p> </li> <li> <p>Further, for the Site300-cE1 device, click on three dots (\u2026) at the right side and click Edit as shown in below screenshots. </p> </li> <li> <p>Click on the Transport and Management VPN section.  </p> </li> <li> <p>Click on Cisco Secure Internet Gateway to add the template.  Select <code>VIP23-SIG-Feature-Template</code> from the drop-down menu. </p> </li> <li> <p>Scroll all the way down to Additional Templates section and ensure Cisco SIG Credentials of <code>Cisco-Umbrella-GLobal-Credintails</code> are selected. </p> </li> <li> <p>Click Update</p> </li> <li> <p>Click Next </p> </li> <li> <p>Click Configure Devices </p> </li> <li> <p>Wait till config push is sucessfull</p> </li> </ul> <p>Now the configurations for IPSec tunnels creation between Site-300 cEdge and Umbrella cloud are done.</p>"},{"location":"Task5/#step-4---sig-tunnels-verificaiton","title":"Step 4 - SIG Tunnels Verificaiton","text":"<p>In this step we will confirm that the tunnels to Umbrella cloud are UP by accessing Umbrella dashboard.</p> <ul> <li> <p>If access to Umbrella dashboard is not already open, on the RDP session, launch Google Chrome and click on <code>Umbrella SSO</code> bookmark to open up a session to Umbrella dashboard.</p> </li> <li> <p>After successful login to Umbrella Dashboard, navigate to Deployments &gt; Core Identities &gt; Network Tunnels</p> </li> </ul> <p></p> <ul> <li> <p>It will take few minutes for tunnels to be Active.  The tunnels will remain in <code>Unestablished Tunnels</code> state initially.  After few minutes there should be 2 <code>Active Tunnels</code> as shown in below screenshot: </p> </li> <li> <p>Using mRemoteNG application on RDP session, launch console session on ubuntu Site300 VPN10 host (Virtual Machine / VM).  </p> </li> <li> <p>Within the console of this Ubuntu VM, launch the Web Browser application and access website <code>welcome.umbrella.com</code>.  This is to verify if Site300 is protected by Umbrella.  What message do you see when you try to access this website?  </p> </li> </ul> <p></p> <p>Why did it fail? This is because, the traffic from SD-WAN site is still going out throught normal interface NOT throught SIG tunnels. We have to create a Service Route to redirect traffic from SD-WAN site on Umbrella SIG Tunnels towards Umbrella Cloud - this will be performed in next step.</p>"},{"location":"Task5/#step-5---redirect-traffic-to-sig-tunnels","title":"Step 5 - Redirect Traffic to SIG tunnels","text":"<p>Let's add a Service Route to SIG in order to redirect traffic from VPN 10 to Umbrella cloud.</p> <ul> <li> <p>On vManage, navigate to Configuration &gt; Templates &gt; Feature Templates </p> </li> <li> <p>In search bar type <code>vpn_10_site300_ce1</code>.  Click the three dots (<code>...</code>) on the right side of this template, and then click Edit in the dropdown menu as shown in below screenshot:  </p> </li> <li> <p>Click Service Route </p> </li> <li> <p>Click New Service Route</p> </li> <li> <p>Add a route to <code>0.0.0.0/0</code> pointing to SIG. </p> </li> <li> <p>Click Add and then Update at the bottom of the page: </p> </li> <li> <p>Click Next and then click Configure Devices</p> </li> <li> <p>Wait till config push is sucessfull </p> </li> <li> <p>Using mRemoteNG application on RDP session (Jumphost), launch console session on ubuntu Site300 VPN10 VM again.  Launch Chromium Web browser and check again by browsing to <code>welcome.umbrella.com</code> URL/website.  The <code>Welcome to Umbrella</code> message indicates that the site is now protected by Umbrella - specifically the traffic in VPN-10 of Site-300 is protected by Umbrella.</p> </li> </ul> <p></p> <ul> <li>On the console session of ubuntu VM  Site300 VPN10 (by using mRemoteNG application), verify traffic routing on this Site-300 by running below command: <pre><code>traceroute 8.8.8.8\n</code></pre></li> </ul> <p>From the output of traceroute, what do you notice different to the output in earlier task on this VM/host?  (Tip: hop count etc)</p>"},{"location":"Task6/","title":"Task 6: Umbrella Policy for Site300","text":"<p>The goal of this Task is to create Umbrella Policies that will:</p> <ul> <li>Use Firewall Policy (i.e., Cloud Delivered Firewall / CDFW) on Umbrella to block any icmp traffic to Google IP address of 8.8.8.8 </li> <li>Use Web Policy (i.e., Secure Web Gateway / SWG) on Umbrella to block web traffic to social media websites.</li> </ul>"},{"location":"Task6/#step-1---firewall-policy","title":"Step 1 - Firewall Policy","text":"<p>In this step, a Firewall Policy on Umbrella Dashboard will be configured to block ICMP traffic.</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>On Umbrella dashboard, go to Policies &gt; Management &gt; Firewall Policy. At the top-right corner, click Add </p> <ul> <li>Create a Rule Name of <code>Block ICMP Google</code>. </li> <li>Under Rule Action select <code>Block</code> from drop-down menu </li> <li>Under Rule Criteria &gt; Protocol select <code>ICMP</code> as the protocol</li> <li>Further under Destinations (under Rule Criteria) select <code>Specify IP</code> from drop-down menu:<ul> <li>Enter CIDR IP Address: <code>8.8.8.8</code> </li> </ul> </li> </ul> </li> <li>Scroll down on the page and Logging Enabled and then Save the policy </li> </ul>"},{"location":"Task6/#step-2---web-policy","title":"Step 2 - Web Policy","text":"<p>In this step, we will configure an Umbrella Web Policy to block web traffic to one social media website i.e., Facebook.</p> <ul> <li> <p>On Umbrella dashboard, go to Policies &gt; Management &gt; Web Policy and click Add on the top right as shown in below screenshot: </p> </li> <li> <p>Click ADD RULE under <code>Ruleset Rules</code>. </p> </li> <li> <p>Give the Rule Name of <code>Block Facebook</code>.  The default Rule Action is <code>Block</code>.  Then click Add Identity as shown below: </p> </li> <li> <p>On the <code>IDENTITIES</code> page, scroll down, select the Network Tunnels and hit Apply as shown in below screenshot.  This will result in selecting the two network tunnels between Umbrella cloud and SD-WAN Site-300: </p> </li> <li> <p>Next, Click on Add Destination in the same <code>Add Rule</code> step: </p> </li> <li> <p>Click on Application Settings (on the right side at the right arrow &gt;), then Scroll down to <code>Social Networking</code> and Click on the right arrow &gt; of the Social Networking. </p> </li> <li> <p>Next, select Facebook and Facebook Messenger and hit Apply </p> </li> <li> <p>On the main Rule screen, Click Save at the right side of the newly created Rule: </p> </li> <li> <p>Click three dots and then Enable Rule </p> </li> <li> <p>Confirm by clicking Update </p> </li> <li> <p>Under Ruleset Settings, go to the Ruleset Identities section and click Edit </p> </li> <li> <p>Select Tunnels under <code>All Identities</code> and click Save </p> </li> <li> <p>Under Ruleset Settings, go to the HTTPS Inspection section and click Edit </p> </li> <li> <p>Select Enable HTTPS Inspection, then Save </p> </li> <li> <p>Scroll down and click Close </p> </li> </ul>"},{"location":"Task6/#step-3---web-policy-tester","title":"Step 3 - Web Policy Tester","text":"<p>Let's go through the steps to test the newly created Web policies by using \"Policy Tester\" on  Umbrella.</p> <ul> <li> <p>On Umbrella Dashboard, navigate to Policies &gt; Management Web Policy.  Click on Policy Tester at the top right corner:  </p> </li> <li> <p>On the <code>Web Policy Tester</code> page,</p> <ul> <li>Under the Primary Identity search box type <code>Site</code> and then select any of the tunnels for Site300 </li> <li>Under Destination, enter <code>facebook.com</code></li> <li>Then click Run Test button:  </li> </ul> </li> <li> <p>The result of this test appears on the page and as expected it shows the Ruleset and rule being matched by the Web policy. </p> </li> <li> <p>Explore the Web Policy Tester further by testing traffic to different destination website such as cisco.com, google.com etc.</p> </li> </ul>"},{"location":"Task6/#step-4---verify-policies","title":"Step 4 - Verify Policies","text":"<p>Now lets validate the impact of both Firewall and Web Policies from the SD-WAN Site-300.</p> <ul> <li> <p>First validate if traffic is being redirected to Umbrella.</p> <ul> <li>Launch console access to ubuntu Site300 VPN10 host by using mRemoteNG application.</li> <li>Use Chromium to navigate to <code>welcome.umbrella.com</code>. A green check mark should appear, confirming that traffic from VPN 10 is being successfully redirected to Umbrella.</li> </ul> </li> <li> <p>Verify Firewall policy enforcement on Umbrella by launching the Terminal application on Site300 VPN10 host.  As per our policy ICMP traffic to 8.8.8.8 should not be allowed.</p> <ul> <li>From the Ubuntu Host on VPN 10, use Terminal issue <code>ping 8.8.8.8</code> command.  Use <code>Ctrl+C</code> to stop the ping.  This ping should fail (as expected).</li> <li>From the Ubuntu Host on VPN 10, use Terminal issue <code>ping 1.1.1.1</code> command.  Use <code>Ctrl+C</code> to stop the ping.  This ping should fail (as expected).</li> </ul> </li> <li> <p>Verify Web Policy by using Chromium Web Browser on Site300 VPN10 host.  Just like previous step, use the console of ubuntu Site300 VPN10 host by using mRemoteNG application.</p> <ul> <li>Use Chromium to navigate onto traditional websites, such as <code>www.cisco.com</code>.  Access to this website should work.</li> <li>Use Chromium to navigate to <code>cnn.com</code>.  Access to this website should work.</li> <li>Use Chromium to navigate onto <code>www.facebook.com</code>.  As per our Umbrella Web Policy, this site should be blocked and, as expected, Cisco Umbrella block page will appear. </li> </ul> </li> </ul>"},{"location":"Task6/#step-5---block-sites-using-destination-list","title":"Step 5 - Block sites using Destination List","text":"<p>In this step we will create a destination list to block customs sites.</p> <ul> <li>Logon on ubuntu host on Site 300 and access cnn.com &amp; bbc.com</li> <li> <p>On Umbrella dashboard, navigate to Policy &gt; Policy Componenet &gt; Destination Lists and Click Add on the top right corner </p> <ul> <li>Enter Name : <code>Custom Block List</code></li> <li>On Destination List Type select Web Policy from the dropdown menu</li> <li>Enter <code>cnn.com</code> and click Add </li> <li>Verify <code>cnn.com</code> is added and Click Save </li> <li>Now Navigate to Policy &gt; Management &gt; Web Policy and expand on RuleSet 1 </li> <li>Click Add Rule </li> <li>Enter Rule name : <code>Custom List</code> and click Add Identity </li> <li>Enable Inherit Ruleset Identities and click Apply </li> <li>Click on Add Destination and then click on 1 next to Destination Lists </li> <li>Select Custom Block List and then click Apply </li> <li>Click Save to save this new rule </li> <li>Click on <code>3 Dots</code> (\u2026) on this newly created rule and toggle the Enable Rule button </li> <li>Click Update on the next message </li> </ul> </li> <li> <p>Let's verify this policy.  Launch console access to ubuntu Site300 VPN10 host by using mRemoteNG application. </p> </li> <li>Logon on ubuntu host on Site-300 and access website <code>cnn.com</code> again.  As expected this site should not be accessible anymore.</li> <li>Follow the same steps and block bbc.com and validate on Ubuntu host on site-300.</li> </ul>"},{"location":"Task7/","title":"Task 7 - Umbrella SIG for Regional sites","text":"<p>In this task, Umbrella SIG will be integrated to Site 100 will be performed.  This integration will be used to route traffic towards Umbrella and enforce Cloud Security policies for local Site 100 as well as for remote Site 400.  Recall that as per IP traffic routing (earlier task) the Internet traffic from Site 400 is also routed via Site 100.  Hence Umbrella policies from these sites will also be </p>"},{"location":"Task7/#step-1---apply-sig-templates-on-vmanage","title":"Step 1 - Apply SIG Templates on vManage","text":"<p>In this step, on vManage, the SIG template in VPN0 on the device template of node Site100-cE1 (in the Transport and Management VPN section) will be performed. </p> <ul> <li> <p>On vManage, navigate to Configuration &gt; Templates. And then Click on Device Templates </p> </li> <li> <p>Edit Site100-cE1 template </p> </li> <li> <p>Click on Transport and Management VPN </p> </li> <li> <p>Click on Cisco Secure Internet Gateway to add the template.  And then Select <code>VIP23-SIG-Feature-Template</code> from the drop-down menu. </p> </li> <li> <p>Scroll all the way down to Additional Templates section and ensure Cisco SIG Credentials of <code>VIP23-SIG-Credentials</code> are added.  </p> </li> <li> <p>Click Update on this page</p> </li> <li> <p>Click Next </p> </li> <li> <p>Click Configure Devices </p> </li> <li> <p>Wait till config push is sucessfull and the configurations are successfully pushed to Site100-cE1</p> </li> </ul>"},{"location":"Task7/#step-2---verify-sig-tunnels-on-umbrella","title":"Step 2 - Verify SIG Tunnels on Umbrella","text":"<p>After configuration of IPSec tunnels to Site100-cE1, let's validate the status of those tunnels.  We can confirm that the tunnels to Umbrella are up by accessing Umbrella dashboard on the Google Chrome via the RDP session.</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Navigate to Deployments &gt; Core Identities &gt; Network Tunnels.  Initially the tunnels will be shown in Unestablished Tunnels but after few minutes these tunnels be active and shown under Active Tunnels as show in below two screenshots:</p> </li> </ul> <p></p> <p></p>"},{"location":"Task7/#step-3---redirect-traffic-to-sig-tunnels","title":"Step 3 - Redirect Traffic to SIG tunnels","text":"<p>Now we need to direct all the VPN-10 traffic from SD-WAN site(s) via these IPSec tunnels towards Umbrella by adding a Service route on vManage</p> <ul> <li>On vManage, navigate to Configuration &gt; Templates &gt; Feature Templates. Then search for <code>VPN_10_05-09-2022_17-18-00_vedge-C8000V_1201</code> and click the three dots (\u2026) and Edit from drop-down menu to modify the template:</li> </ul> <p> </p> <ul> <li> <p>Click Service Route </p> </li> <li> <p>Click New Service Route</p> </li> <li> <p>Add a Prefix of <code>0.0.0.0/0</code> pointing to SIG. </p> </li> <li> <p>Click Add and then click Update at the bottom of the page </p> </li> <li> <p>click Next and then click Configure Devices</p> </li> <li> <p>Wait till config push is sucessfull to Site100-cE1.  </p> </li> <li> <p>Optional: you may SSH to Site100-cE1 by using MTPutty application on RDP session (Jumphost).  Validate that the service route command <code>ip sdwan route vrf 10 0.0.0.0/0 service sig</code> are pushed by vManage.</p> </li> </ul> <p>Now all the required configurations on SD-WAN are in-place to route the traffic from Site-100 and Site-400 towards Umbrella using the IPSec tunnels.  Next, the Cloud Security policies for these sites will be configured on Umbrella. </p>"},{"location":"Task8/","title":"Task 8 - Umbrella Regional Policies","text":"<p>This tasks will walk through the steps to create Web Proxy Policies that will be enforced on Site-100 and Site-400 (i.e., regional sites).  These policies will: * Block web traffic to Financial Institutions * Block web traffic to additional websites by creating custom destination list</p>"},{"location":"Task8/#step-1---umbrella-web-policy","title":"Step 1 - Umbrella Web Policy","text":"<p>In this step we will configure Umbrella Web Policy to block traffic to Financial websites from Regional sites:</p> <ul> <li> <p>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>.  It will open the Umbrella dashboard and auto-login using single-sign-on.</p> </li> <li> <p>Go to Policies &gt; Management &gt; Web Policy and click Add on the top right to add a new Ruleset as shown in below screenshot:</p> </li> </ul> <p></p> <ul> <li>On the new \"Ruleset Rules\" web page, under Ruleset Settings scroll down to Ruleset identities and Click Edit as shown below:</li> </ul> <p></p> <ul> <li>Next on the Ruleset Identities web page, under <code>All Identities</code> scroll down to Tunnels and Click on number 4 with right arrow i.e., <code>4 &gt;</code> as shown below:</li> </ul> <p></p> <ul> <li>On the next page, select the two Tunnels for SITE100 and Click SAVE button as shown below: </li> </ul> <p></p> Note: You must only select SITE100 tunnels.  Do not select SITE300 tunnels in this step. <ul> <li>Under the Ruleset Settings, scroll down to HTTPS Inspection section and click Edit:</li> </ul> <p></p> <ul> <li>Select Enable HTTPS Inspection, then click Save:</li> </ul> <p> </p> <ul> <li>After adding the identities, Click ADD RULE button.  Give the Rule Name of <code>Regional - block Financial</code> and verify the <code>Rule Action</code> is <code>Block</code>:</li> </ul> <p></p> <ul> <li>Next click on Add Identity for this rule.  Enable Inherit Ruleset Identities and click Apply as shown in below figure:</li> </ul> <p></p> <ul> <li>Further on the new rule, click on Add Destination and Click on right arrow <code>&gt;</code> next to Application Settings:</li> </ul> <p></p> <ul> <li>Then scroll down to Select Financial Services and hit Apply:</li> </ul> <p></p> <ul> <li>On the Rule click on Save icon to save newly added rule as shown in below screenshot:</li> </ul> <p></p> <ul> <li>By default newly created rules are disabled.  To enable the Rule 1, click three dots (<code>...</code>) at the right side and then toggle Enable Rule as shown in below screenshot. </li> </ul> <p></p> <ul> <li>Confirm by clicking Update:</li> </ul> <p></p> <p>Now the rule and ruleset settings are all configured for Regional sites.</p> <ul> <li>Scroll down and click Close as shown in below screenshot </li> </ul>"},{"location":"Task8/#step-2---create-customs-list-web-policy","title":"Step 2 - Create Customs-list Web Policy","text":"<p>In the previous step, a web policy as per Umbrella classification of Financial services websites has been created.  Now let's create our own website list (using Umbrella <code>Destination List</code>) and then use Web policy to block web traffic to this list i.e., custom URL.  This will be done by adding a new rule under existing Ruleset for regional sites i.e., Ruleset 2.</p> <ul> <li>On Umbrella dashboard, navigate to Policy &gt; Policy Component &gt; Destination lists, click Add on the top right corner:</li> </ul> <p></p> <ul> <li> <p>Add this list as per below settings:</p> <ul> <li>List Name: <code>Custom-Filter</code></li> <li>Destination List type: <code>Web Proxy</code> (from drop-down menu)</li> <li>Destination: <code>www.cnn.com</code></li> <li> <p>Click <code>Add</code> </p> </li> <li> <p>Click Save after adding destination/domain: </p> </li> </ul> </li> <li> <p>Navigate to Policies &gt; Management &gt; Web Policy and expand on RuleSet 2 by clicking on it or by clicking down-arrow:</p> <p></p> </li> <li> <p>Let's add a new rule by clicking ADD RULE button.  Give the Rule Name of <code>Regional - block custom</code> and verify the <code>Rule Action</code> is <code>Block</code>: </p> </li> <li> <p>Next let's also use ruleset identities for this rule.  Click on Add Identity for this rule and enable Inherit Ruleset Identities and click Apply as shown in below figure:</p> </li> </ul> <p></p> <ul> <li>Further on the new rule, click on Add Destination and CLick on the right arrow  <code>&gt;</code> next to Destiniation Lists</li> </ul> <p></p> <ul> <li>Select the Custom-Filter and then click on Apply</li> </ul> <p></p> <ul> <li> <p>Click on Save on this newly created rule: </p> </li> <li> <p>By default newly created rules are disabled.  To enable the Rule 2, click three dots (<code>...</code>) at the right side and then toggle Enable Rule as shown in below screenshot. </p> </li> </ul> <p></p> <ul> <li>Confirm by clicking Update:</li> </ul> <p></p> <ul> <li>After saving the rule, You may scroll down under Ruleset settings and click on Close button.</li> </ul> <p>Now the Umbrella policies for regional sites (site-100 and Site-400) have been configured. </p>"},{"location":"Task8/#step-3---web-policy-tester","title":"Step 3 - Web Policy Tester","text":"<p>Let's go through the steps to test the newly created Web policies by using \"Policy Tester\" on  Umbrella.</p> <ul> <li> <p>On Umbrella Dashboard, navigate to Policies &gt; Management &gt; Web Policy.  Click on Policy Tester at the top right corner:  </p> </li> <li> <p>On the <code>Web Policy Tester</code> page,</p> <ul> <li>Under the Primary Identity search box type <code>Site1</code> and then select any of the Site100 tunnels </li> <li>Under Destination, enter <code>chase.com</code></li> <li>Then click Run Test button:  </li> </ul> </li> </ul> <p>The result of this test appears on the page and as expected it shows the Ruleset 2 and rule being matched by the Web policy. </p> <ul> <li>Next run a test for any of the Site100 tunnel for below destinations:<ul> <li>Under Destination, enter <code>www.cnn.com</code> </li> </ul> </li> </ul> <p>The result of this test appears on the page and as expected it shows the Ruleset 2 and rule being matched by the Web policy. </p> <ul> <li>Explore the Web Policy Tester further by testing traffic to different destination website such as cisco.com, google.com etc for Regional sites traffic.</li> </ul>"},{"location":"Task8/#step-4---verify-policies-on-hosts","title":"Step 4 - Verify Policies on Hosts","text":"<p>Now lets validate the impact of both Firewall and Web Policies from the SD-WAN Site-400 (Regional site).</p> <ul> <li> <p>First validate if traffic is being redirected to Umbrella.</p> <ul> <li>Launch console access to ubuntu Site400-VPN10 host by using mRemoteNG application.  Login with credentials of <code>viptela</code></li> <li>Use Chromium Browser to navigate to <code>welcome.umbrella.com</code>.  A green check mark should appear, confirming that traffic from VPN 10 is being successfully redirected to Umbrella.</li> </ul> </li> <li> <p>Verify Web Policy by using Chromium Web Browser on Site400-VPN10 host.  Just like previous step, use the console of ubuntu Site400 VPN10 host by using mRemoteNG application.</p> <ul> <li>Use Chromium to navigate onto traditional websites, such as <code>www.cisco.com</code>.  Access to this website should work.</li> <li>Use Chromium to navigate to <code>www.cnn.com</code>.  As per our Umbrella Web Policy, this site should be blocked and, as expected, Cisco Umbrella block page will appear.</li> <li>Use Chromium to navigate to <code>www.chase.com</code>.  As per our Umbrella Web Policy, this sites should be blocked and, as expected, Cisco Umbrella block page will appear.</li> <li>Use Chromium to navigate to <code>www.bankofamerica.com</code>.  As per our Umbrella Web Policy, this sites should be blocked and, as expected, Cisco Umbrella block page will appear.</li> <li>Use Chromium to navigate onto <code>www.facebook.com</code>.  Access to this site should work as expected</li> </ul> </li> </ul>"},{"location":"Task9/","title":"Task 9 - Monitoring on Umbrella","text":"<p>In this task reports on Cisco Umbrella will be used to monitor it's usage, traffic detection, policy enforcement and the SD-WAN integration. </p> <p>As a Pre-requisite:, all the prior tasks must be completed successfully.  These earlier tasks include integration of SD-WAN sites to Umbrella, configuraiton of Umbrella policies such as Firewall, Web etc.  The traffic monitored by Umbrella, as per those policies, will be viewed in this task.</p>"},{"location":"Task9/#step-1-traffic-from-sd-wan-sites","title":"Step 1: Traffic from SD-WAN sites","text":"<p>In this step, additional IP and Web traffic will be initiated for Umbrella monitoring.</p> <ul> <li>On the RDP session, use <code>mRemoteNG</code> application to logon the console of VM named <code>Site300-Ubuntu-VPN10</code>.  This VM exists on VPN #10 of this site.</li> <li>Launch Chromium web browser and visit the website <code>cisco.com</code>.  This website should be accessible. </li> <li>On the Chromium web browser navigate to <code>facebook.com</code>.  As per earlier configured policy, the traffic to <code>facebook.com</code> should be blocked by Umbrella on Site-300. </li> <li> <p>On the <code>mRemoteNG</code> application launch the Terminal application in the RDP session of the <code>Site300-Ubuntu-VPN10</code>.  Then initiate ICMP traffic by issuing below <code>ping</code> command.  After few seconds stop the ping by pressing <code>Control-C</code>.  A 100% success rate in the ping results confirms successful Internet connectivity through Umbrella. <pre><code>ping 1.1.1.1\n</code></pre></p> </li> <li> <p>In the same terminal of the <code>Site300-VPN10</code> host, execute the command below. After a few seconds, halt the ping by pressing <code>Control-C</code>. According to the previous configuration, Umbrella should block this traffic: <pre><code>ping 8.8.8.8\n</code></pre></p> </li> </ul> <p>Next, * On the RDP session, use <code>mRemoteNG</code> application to logon the console of VM named <code>Site400-Ubuntu-VPN10</code>.  This VM exists on VPN #10 of this site. * From the Chromium Web browser initiate traffic to <code>www.cnn.com</code> and <code>cisco.com</code>.   As per earlier task, the traffic to <code>www.cnn.com</code> should be blocked by Umbrella.  * On the <code>mRemoteNG</code> application launch the Terminal application in the RDP session of the <code>Site400-Ubuntu-VPN10</code>.  Then initiate ICMP traffic by issuing below <code>ping</code> command.  After few seconds stop the ping by pressing <code>Control-C</code>.  A 100% success rate in the ping results confirms successful Internet connectivity through Umbrella. <pre><code>ping 1.1.1.1\n</code></pre></p>"},{"location":"Task9/#step-2---activity-reports-for-web-urls","title":"Step 2 - Activity Reports for Web URLs","text":"<p>The web and other IP traffic activity from the SD-WAN branch sites over a selected time period can be viewed from <code>Activity Search</code> on Cisco Umbrella.  These reports can be filtered by various categories such as identity name, destination, source IP, etc.  </p> <ul> <li> <p>On the RDP session (jumphost), access the Umbrella web page by clicking on <code>Umbrella SSO</code> bookmark on Google Chrome browser.</p> </li> <li> <p>Go to Reporting &gt; Core Reports and click on Activity Search:</p> </li> </ul> <p></p> <p>Here you can view the result of every DNS, URL, and IP request from your various SD-WAN sites and other identities.  Browse through to view some of the past results.</p> <ul> <li> <p>Click on blue Filters button to close the filter tab and then click on Advanced button in the <code>Search</code> field/bar.  </p> </li> <li> <p>On the <code>Advanced Search</code> page, navigate to to the <code>URL</code> section and enter <code>cnn.com</code>.  Then click Apply as shown in below screenshot:</p> </li> </ul> <p></p> <p>You will now see all the search results matching URL of <code>cnn.com</code>.  Below is an example screenshot for these results (your view may be different):</p> <p></p> <p>As per these search results:</p> <ul> <li>Note that the search results shows all Web Requests related to <code>cnn.com</code> i.e., Secure Web Gateway (or Web Proxy) of Umbrella logged these requests.</li> <li>Use the Scroll bar at the bottom to move right and review the various fields such as <code>Action</code>, <code>Categories</code> and <code>Ruleset or Rule</code> fields of the results (each row) shown on this page.</li> <li>Further on the right side of each row, click on the three dots (<code>...</code>) and then click <code>View Full Details</code> to see detailed info as shown in below screenshot:</li> </ul> <p></p> <p>In summary the info in Activty search results matches the configurations performed in earlier tasks!</p> <ul> <li>Click on Advanced button in the <code>Search</code> field again.  On the <code>Advanced Search</code> page, enter <code>facebook.com</code> as the second <code>URL</code> and click Apply button as shown below:</li> </ul> <p></p> <ul> <li>View the updated Activity results.  Below screenshot is an example for such result and your data may vary:</li> </ul> <p></p> <ul> <li>In the search result, review the various fields such as <code>Action</code>, <code>Categories</code> and <code>Ruleset or Rule</code> fields of the results (each row) shown on this page and verify that results match the configurations performed in earlier tasks.</li> </ul>"},{"location":"Task9/#step-2---activity-reports-for-firewall","title":"Step 2 - Activity Reports for Firewall","text":"<p>In this task, results of Umbrella monitoring for Firewall traffic will be viewed</p> <ul> <li> <p>In the Umbrella Dashboard on Google Chrome, clear the existing <code>Advanced</code> Filter by clicking on <code>CLEAR</code> button or click on cross (<code>X</code>) next to the URL field on this page.  Thus Web filters for <code>cnn.com</code> and <code>facebook.com</code> are cleared from Activity Search page.  Alternatively, just navigate back to Reporting &gt; Core Reports &gt; Activity Search.</p> </li> <li> <p>Next, Click on Advanced button in the <code>Search</code> field/bar.</p> </li> <li> <p>On the <code>Advanced Search</code> page, navigate to the <code>IP Address</code> section, enter <code>1.1.1.1</code> and hit Apply: </p> </li> <li> <p>Now you can review the search results for all traffic related to IP address of <code>1.1.1.1</code> that is detected by Umbrella Firewall (FW).  Below is an example of this search result - your result may vary:</p> </li> </ul> <p></p> <ul> <li> <p>Next, <code>Clear</code> these search results and remove the filter for <code>1.1.1.1</code>. </p> </li> <li> <p>Create a new <code>Advanced Search</code> filter for <code>IP Address</code> of <code>8.8.8.8</code> (using the same procedure as above).  </p> </li> <li> <p>Revew the search results IP address of <code>8.8.8.8</code>.  Below is an example of screenshot for this search (note your result may be different).  As per <code>Actions</code> field, you will see both <code>Allowed</code> and <code>Blocked</code>.  Why do you see both of these actions?  </p> </li> </ul> <p>Tip: Have a look at details of these packets by clicking on <code>view Full Details</code> and then review the <code>Protocol</code> field (ICMP, UDP)!</p> <p></p>"},{"location":"Task9/#step-3---top-destinations-reports","title":"Step 3 - Top Destinations Reports","text":"<p>In this step we will view the traffic to most active destinations on Umbrella Dashboard. </p> <ul> <li> <p>On Umbrella Dashboard, navgiate to Reporting &gt; Additional Reports &gt; Top Destinations.  It will show the most visited destinations.   </p> </li> <li> <p>In previous tasks, on Ubuntu Virtual Machines at the SD-WAN sites, you had browsed to various websites.  As Ubuntu VM settings the DNS queries will be routed via DNS Resolver with IP address of <code>1.1.1.1</code>.  Below Figure shows an example screenshot from a lab system.  Note: Your screen may not have the same output. Click on <code>1.1.1.1</code> among the list of destinations as shown below:</p> </li> </ul> <p></p> <ul> <li>Once <code>1.1.1.1</code> is clicked it will show below screenshot.  Click on <code>VIEW 1.1.1.1 IN INVESTIGATE</code> to view more details of this IP address as shown below</li> </ul> <p></p> <ul> <li>The investigate page shows more details about this IP address as shown in below screenshot.  Click on Talos to view the reputation and other intelligence from Cisco Talos about this IP address. </li> </ul> <p>Here is the screenshot from Cisco Talos about this IP address </p>"},{"location":"Task9/#optional-step-4---additional-reports","title":"Optional Step 4 - additional reports","text":"<p>If you have time then you can proceed to view various other reports on Umbrella Dashboard:</p> <ul> <li> <p>Navigate to Reporting &gt; Additional Request &gt; Top Identities to view the traffic by various Identities.  As expected, the Network tunnels (four) will be shown here.  <code>Allowed</code> or <code>Blocked</code> Responses by specific Traffic type can also be viewed on this page by clicking under the <code>Responses</code>.   You can vew the Tunnel and site with most traffic and the respective count (i.e. number of <code>Requests</code>) in your lab pod on this page.</p> </li> <li> <p>Navigate to Reporting &gt; Additional Request &gt; Total Request to view Traffic by type (<code>Firewall</code>, <code>DNS</code>, <code>Web</code>, All) and Responses (<code>Allowed</code>, <code>Blocked</code>).  You can check for Allowed or Blocked by Traffic type can be viewed on this page by clicking under the <code>Responses</code> </p> </li> <li> <p>Navigate to Reporting &gt; Additional Request &gt; Top Categories to view the traffic by various categories such as Advertisements, Search Engines etc.  Note traffic size and number of requests by various categories is shown in these reports.</p> </li> </ul> <p>This concludes the task for using some of the Umbrella monitoring capabilities.</p>"},{"location":"Task9/#well-done-","title":"Well Done! ##","text":""},{"location":"Topology/","title":"Lab Topology","text":"<p>#Topology</p> <p></p>"}]}