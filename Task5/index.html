
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.11">
    
    
      
        <title>Task 5: Umbrella integration with Site-300 - Cisco Live 2024 LTRENT-2387</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a6bdf11c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sans+Serif:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Sans Serif";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="green">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#task-5-umbrella-integration-with-site-300" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cisco Live 2024 LTRENT-2387" class="md-header__button md-logo" aria-label="Cisco Live 2024 LTRENT-2387" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cisco Live 2024 LTRENT-2387
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Task 5: Umbrella integration with Site-300
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="yellow"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ciscolivelab/LTRENT-2387" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../Topology/" class="md-tabs__link">
        Lab Overview
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../Task1-Connect/" class="md-tabs__link">
        Lab Guide
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cisco Live 2024 LTRENT-2387" class="md-nav__button md-logo" aria-label="Cisco Live 2024 LTRENT-2387" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Cisco Live 2024 LTRENT-2387
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ciscolivelab/LTRENT-2387" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="..">Home</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Lab Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Lab Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Topology/" class="md-nav__link">
        Lab Topology
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Lab Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Lab Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Task1-Connect/" class="md-nav__link">
        Task-1 VPN connection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Task2-v1/" class="md-nav__link">
        Task-2 vManage Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Task3-v1/" class="md-nav__link">
        Task-3 Internet Access for SD-WAN Site-100 & Site-400
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Task4-v1/" class="md-nav__link">
        Task-4 Direct Internet for SD-WAN Site-300
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Task5-v1/" class="md-nav__link">
        Task-5 Umbrella Integration to Site-300
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Task6-v1/" class="md-nav__link">
        Task-6 Umbrella Policies for Site-300
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Task7-v1/" class="md-nav__link">
        Task-7 Umbrella Integration to Site-100
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Task8-v1/" class="md-nav__link">
        Task-8 Umbrella Policies for Site-100 & 400
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Task9/" class="md-nav__link">
        Task-9 Monitoring on Umbrella
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Task10/" class="md-nav__link">
        Task-10 Block Page for Regional Sites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Task11/" class="md-nav__link">
        Task-11 Data Loss Prevention
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1---umbrella-organization-id" class="md-nav__link">
    Step 1 - Umbrella Organization ID
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2---umbrella-api-key" class="md-nav__link">
    Step 2 - Umbrella API Key
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3---update-sig-feature-template-on-vmanage" class="md-nav__link">
    Step 3 - Update SIG Feature Template on vManage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4---apply-sig-feature-template-on-vmanage" class="md-nav__link">
    Step 4 - Apply SIG Feature Template on vManage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5---verify-sig-tunnels" class="md-nav__link">
    Step 5 - Verify SIG Tunnels
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6---redirect-traffic-to-sig-tunnels" class="md-nav__link">
    Step 6 - Redirect Traffic to SIG tunnels
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="task-5-umbrella-integration-with-site-300">Task 5: Umbrella integration with Site-300<a class="headerlink" href="#task-5-umbrella-integration-with-site-300" title="Permanent link"></a></h1>
<p>In this task we will intergrate Site-300 with Cisco Umbrella.  As a result of this integration, SD-WAN Site-300 and Umbrella will have active &amp; backup IPSec tunnels and IP traffic from this site will be routed externally (Public Cloud, SaaS applications, Public Internet etc) via Umbrella.  This integration will allow to monitor and enforce Security capabilities from Umbrella cloud - this part will be done in a later task.</p>
<h2 id="step-1---umbrella-organization-id">Step 1 - Umbrella Organization ID<a class="headerlink" href="#step-1---umbrella-organization-id" title="Permanent link"></a></h2>
<ul>
<li>On the RDP session (jumphost), logon to Umbrella Dashboard by clicking on Google Chrome Browser bookmark named <code>Umbrella SSO</code>. It will automtically open the Umbrella dashboard and auto-login using single-sign-on.</li>
</ul>
<p><img alt="" src="../pics/Umbrella.png" /></p>
<table>
<thead>
<tr>
<th align="left">Note:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Click through the security warning to ignore the certificate (if prompted).</td>
</tr>
</tbody>
</table>
<ul>
<li>Umbrella organization (Org) is a separate instance of Umbrella and has its own dashboard.  An <strong><code>Org ID</code></strong> is used to identify each organization and for integrating Umbrella with Cisco SD-WAN.  This <strong><code>Org ID</code></strong> is a number and part of the Umbrella web URL and must be extracted from the URL.  This <strong><code>Org ID</code></strong> will be required at a later step as part of vManage configurations for Umbrella SIG integration.  Once you are logged into the Umbrella dashboard, extract <strong><code>[Org ID]</code></strong> from the URL in the address bar as per below syntax:</li>
</ul>
<div class="highlight"><pre><span></span><code>https://dashboard.umbrella.com/o/[Org ID]/#/...
</code></pre></div>
<p>Below figure is only an example showing <strong><code>Org ID</code></strong> of <strong><code>1234567</code></strong>:</p>
<p><img alt="" src="../pics/Umbrella-ord-id-1.png" /></p>
<h2 id="step-2---umbrella-api-key">Step 2 - Umbrella API Key<a class="headerlink" href="#step-2---umbrella-api-key" title="Permanent link"></a></h2>
<p>We will generate an API token (Key, Secret) from the Umbrella dashboard, which will be used in the SD-WAN (vManage) configurations in later step. </p>
<ul>
<li>
<p>After logging on Umbrella dashboard (as per previous step), navigate to <strong>Admin &gt; API Keys</strong> page.</p>
</li>
<li>
<p>On this page, Click on <strong><code>Legecy Keys</code></strong>.  Next, click on <strong><code>Umbrella Management</code></strong> and then click on <strong><code>Generate Token</code></strong> as shown in below figures.  This will generate API <code>Key</code> and <code>Secret</code></p>
</li>
</ul>
<p><img alt="" src="../pics/Umbrella-keys.png" />
<img alt="" src="../pics/Umbrella-keys-2.png" /></p>
<ul>
<li>You must <strong>copy</strong> both <strong><code>Key</code></strong> and <strong><code>Secret</code></strong> on a notepad - this information, along with <strong><code>Org ID</code></strong> in pervious step will be used later on during vManage configurations.</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Note:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">You must copy both <strong><code>Key</code></strong> and <strong><code>Secret</code></strong> in a notepad.  It is only shown on this page once and will not be visible afterwards.</td>
</tr>
</tbody>
</table>
<h2 id="step-3---update-sig-feature-template-on-vmanage">Step 3 - Update SIG Feature Template on vManage<a class="headerlink" href="#step-3---update-sig-feature-template-on-vmanage" title="Permanent link"></a></h2>
<p>Now we will add these Umbrella API credentials (<strong><code>Key</code></strong> &amp; <strong><code>Secret</code></strong>) along with <strong><code>Org ID</code></strong> in vManage configurations.  This will allow vManage to automate IPSec tunnel configurations as part of it's workflow.</p>
<ul>
<li>On vManage, navigate to <strong>Configuration &gt; Templates</strong> as shown below:</li>
</ul>
<p><img alt="" src="../pics/Config-Template.png" /> </p>
<ul>
<li>Then click on <strong><code>Feature Templates</code></strong> tab as shown in below screenshot:</li>
</ul>
<p><img alt="" src="../pics/Config-Template-Feature.png" /></p>
<ul>
<li>Then in the search bar type <strong><code>sig</code></strong> and find the template with name of <strong><code>VIP23-SIG-Feature-Template</code></strong>.  Further, click on three dots (<strong><code>...</code></strong>) at the right side of this feature template and click <strong>Edit</strong> as shown in below Figure:</li>
</ul>
<p><img alt="" src="../pics/sig-feat-temp-3.png" /></p>
<ul>
<li>Click on <strong>"Click here to create - Cisco SIG Credentials Template"</strong> as shown in below Figure:</li>
</ul>
<p><img alt="" src="../pics/sig-feat-temp-4.png" /></p>
<ul>
<li>Enter Umbrella <strong><code>Org ID</code></strong>, <strong><code>Keys</code></strong> and <strong><code>Secret</code></strong> that were copied &amp; saved in previous steps and then click <strong><code>Save</code></strong> on this page:</li>
</ul>
<p><img alt="" src="../pics/sig-feat-temp-2.png" /></p>
<ul>
<li>Then click <strong><code>Update</code></strong> at the bottom of the page:</li>
</ul>
<p><img alt="" src="../pics/sig-feat-temp-5.png" /></p>
<p>After successfully saving Umbrella API Token credentials, in the next step, let's apply this Feature template to Site300-cE1 Device template so IPSec tunnels can be established between Umbrella SIG and Site300-cE1.  </p>
<h2 id="step-4---apply-sig-feature-template-on-vmanage">Step 4 - Apply SIG Feature Template on vManage<a class="headerlink" href="#step-4---apply-sig-feature-template-on-vmanage" title="Permanent link"></a></h2>
<p>The previously saved SIG template will be applied to <strong>Site300-cE1</strong> device for Umbrella SIG integration i.e. setting up IPSec tunnels with between Site300 and Umbrella cloud.</p>
<ul>
<li>On vManage, navigate to <strong>Configuration &gt; Templates</strong>.  And then click on <strong><code>Device Templates</code></strong> as shown below:</li>
</ul>
<p><img alt="" src="../pics/Device-template.png" /></p>
<ul>
<li>Search for the <strong>Site300-cE1</strong> device in the <code>Description</code> field.  Then click on three dots (<strong><code>...</code></strong>) at the right side of <strong>Site300-cE1</strong> and click <strong>Edit</strong> as shown in below Figure:</li>
</ul>
<p><img alt="" src="../pics/sig-feat-temp-6.png" /></p>
<ul>
<li>Once the <code>Device Template</code> is open, Click on the <strong><code>Transport and Management VPN</code></strong> to navigate to that section:</li>
</ul>
<p><img alt="" src="../pics/sig-feat-temp-7.png" /></p>
<ul>
<li>Click on <strong><code>Cisco Secure Internet Gateway</code></strong> to add this template to the Device.  After adding it, select its value of <strong><code>VIP23-SIG-Feature-Template</code></strong> from the drop-down menu as shown in below Figure:</li>
</ul>
<p><img alt="" src="../pics/sig-feat-temp-8.png" /></p>
<ul>
<li>Scroll all the way down to <code>Additional Templates</code> section and ensure <strong>Cisco SIG Credentials</strong> of <strong><code>Cisco-Umbrella-Global-Credentials</code></strong> are selected:</li>
</ul>
<p><img alt="" src="../pics/sig-feat-temp-9.png" /></p>
<ul>
<li>
<p>Now click <strong><code>Update</code></strong> on this page</p>
</li>
<li>
<p>Then click <strong><code>Next</code></strong> to proceed forward with configuration:</p>
</li>
</ul>
<p><img alt="" src="../pics/sig-feat-temp-10.png" /></p>
<ul>
<li>Click <strong><code>Configure Devices</code></strong> at the bottom of the page to push the configuration from vManage towards cEdge:</li>
</ul>
<p><img alt="" src="../pics/sig-feat-temp-11.png" /></p>
<ul>
<li>Lastly, wait and verify that Config-Push from vManage to cEdge device is <code>Success</code></li>
</ul>
<p>Now the configurations for IPSec tunnels creation between Site-300 cEdge and Umbrella cloud are done.</p>
<h2 id="step-5---verify-sig-tunnels">Step 5 - Verify SIG Tunnels<a class="headerlink" href="#step-5---verify-sig-tunnels" title="Permanent link"></a></h2>
<p>In this step we will confirm that the IPSec tunnels between Umbrella cloud and SD-WAN Site-300 are UP by accessing Umbrella dashboard.</p>
<ul>
<li>
<p>If access to Umbrella dashboard is not already open, on the RDP session, launch Google Chrome and click on <code>Umbrella SSO</code> bookmark to open up a session to Umbrella dashboard.</p>
</li>
<li>
<p>After successful login to Umbrella Dashboard, navigate to <strong>Deployments &gt; Core Identities &gt; Network Tunnels</strong></p>
</li>
</ul>
<p><img alt="" src="../pics/umbrella-tun-unauth.png" /></p>
<ul>
<li>It will take few minutes for tunnels to be <strong>Active</strong>.  The tunnels will remain in <code>Unestablished Tunnels</code> state initially.  After few minutes there should be <strong>2</strong> <code>Active Tunnels</code> as shown in below screenshot:</li>
</ul>
<p><img alt="" src="../pics/sig-feat-temp-12.png" /></p>
<ul>
<li>
<p>Using <strong>mRemoteNG</strong> application on RDP session, launch console session of Ubuntu <code>Site300-Ubuntu-VPN10</code> host (Virtual Machine / VM).  </p>
</li>
<li>
<p>Within the console of this Ubuntu VM, launch the <strong>Web Browser</strong> application and access website <strong><code>welcome.umbrella.com</code></strong>.  This is to verify if Site-300 is protected by Umbrella.  What message do you see when you try to access this website?  </p>
</li>
</ul>
<p><img alt="" src="../pics/umbrella-oops.png" /></p>
<p><em>Why did it fail?</em></p>
<p>It failed because the traffic from SD-WAN site is still routed through the normal interface and not through the IPSec tunnels.  We have to create a <strong>Service Route</strong> to redirect traffic from SD-WAN site on <strong>Umbrella SIG Tunnels</strong> towards Umbrella Cloud - this will be performed in next step.</p>
<h2 id="step-6---redirect-traffic-to-sig-tunnels">Step 6 - Redirect Traffic to SIG tunnels<a class="headerlink" href="#step-6---redirect-traffic-to-sig-tunnels" title="Permanent link"></a></h2>
<p>Let's add a Service Route to SIG in order to redirect traffic from VPN-10 on Site-300 towards Umbrella cloud.</p>
<ul>
<li>On vManage, navigate to <strong>Configuration &gt; Templates</strong>.  And then click on <strong><code>Feature Templates</code></strong>:</li>
</ul>
<p><img alt="" src="../pics/Config-Template-Feature.png" /></p>
<ul>
<li>In search bar type <strong><code>vpn_10_site300_ce1</code></strong>.  From the search results, locate this template and <strong>Click</strong> the three dots (<strong><code>...</code></strong>) on the right side of this template.  Then click <strong><code>Edit</code></strong> in the dropdown menu as shown in below Figures:</li>
</ul>
<p><img alt="" src="../pics/Config-Template-Feature.png" />
<img alt="" src="../pics/sig-feat-temp-13.png" /></p>
<ul>
<li>On the next page, Click <strong><code>Service Route</code></strong> to navigate to that section:</li>
</ul>
<p><img alt="" src="../pics/sig-feat-temp-14.png" /></p>
<ul>
<li>Then on this section, Click on <strong><code>New Service Route</code></strong> and Add a route as per:</li>
<li><code>Prefix</code> of <strong><code>0.0.0.0/0</code></strong> </li>
<li><code>Service</code> of <strong><code>SIG</code></strong> (default setting)</li>
<li>Click <strong><code>Add</code></strong> and then <strong><code>Update</code></strong> at the bottom of the page as shown in below Figure:</li>
</ul>
<p><img alt="" src="../pics/sig-feat-temp-15.png" /></p>
<ul>
<li>
<p>Click <strong><code>Next</code></strong> and then click <strong><code>Configure Devices</code></strong></p>
</li>
<li>
<p>Lastly, wait and verify that Config-Push from vManage to cEdge device is <code>Success</code> as shown below:</p>
</li>
</ul>
<p><img alt="" src="../pics/Site400-VPN10-Ftemp-IPv4-5.png" /></p>
<ul>
<li>Using <strong>mRemoteNG</strong> application on RDP session (Jumphost), launch console session of ubuntu <code>Site300-Ubuntu-VPN10</code> VM again.  Launch Chromium Web browser and check again by browsing to <strong><code>welcome.umbrella.com</code></strong> URL/website.  The <code>Welcome to Umbrella</code> message indicates that the site is now protected by Umbrella - specifically the traffic in VPN-10 of Site-300 is protected by Umbrella.</li>
</ul>
<p><img alt="" src="../pics/Umbrella-welecome.png" /></p>
<ul>
<li>On the console session of ubuntu VM <code>Site300-Ubuntu-VPN10</code> (by using <strong>mRemoteNG</strong> application), verify traffic routing on this Site-300 by running below command:</li>
</ul>
<div class="highlight"><pre><span></span><code>traceroute 8.8.8.8
</code></pre></div>
<p>From the output of traceroute, what do you notice different to the output in earlier task on this VM/host? 
<em>(Tip: hop count etc)</em></p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "navigation.instant", "navigation.indexes", "navigation.footer", "toc.follow", "content.tabs.link", "search.share", "search.highlight", "search.suggest", "content.code.copy", "content.code.annotations"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fac441b0.min.js"></script>
      
        <script src="../extra/refresh_on_toggle_dark_light.js"></script>
      
    
  </body>
</html>